(this.webpackJsonpcityscopejs=this.webpackJsonpcityscopejs||[]).push([[0],{403:function(e,t){},57:function(e){e.exports=JSON.parse('{"docsURL":"https://raw.githubusercontent.com/CityScope/CS_cityscopeJS/master/docs/","cityIO":{"mockURL":"http://localhost:3001","baseURL":"https://cityio.media.mit.edu/api/table/","interval":500,"cityIOmodules":["header","GEOGRID","ABM","grid","access","GEOGRIDDATA","indicators"]},"map":{"mapStyle":{"sat":"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true","dark":"mapbox://styles/relnox/cjl58dpkq2jjp2rmzyrdvfsds?fresh=true","blue":"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"},"layers":{"ABM":{"startSimHour":25200,"endSimHour":50400,"animationSpeed":20},"heatmap":{"colors":[[213,62,79],[252,141,89],[254,224,139],[230,245,152],[153,213,148],[50,136,189]]}},"initialViewState":{"zoom":17,"pitch":0,"bearing":0}},"menu":{"toggles":{"GRID":{"displayName":"Interactive Grid","showOnInit":true,"requireModule":"GEOGRID"},"ABM":{"displayName":"Mobility Simulation","showOnInit":false,"requireModule":"ABM"},"AGGREGATED_TRIPS":{"displayName":"Aggregated Trips","showOnInit":false,"requireModule":"ABM"},"ACCESS":{"displayName":"Accessibility Analysis","showOnInit":false,"requireModule":"access"},"RADAR":{"displayName":"Urban Indicators","showOnInit":false,"requireModule":"indicators"},"ROTATE":{"displayName":"Rotate Camera","showOnInit":false,"requireModule":false},"SHADOWS":{"displayName":"Toggle Shadows","showOnInit":true,"requireModule":"GEOGRID"},"KEYSTONE":{"displayName":"Projection Mapping","showOnInit":false,"requireModule":false}}}}')},581:function(e,t,a){e.exports=a(688)},589:function(e,t,a){},59:function(e){e.exports=JSON.parse('{"map":{"mapStyle":{"sat":"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true","dark":"mapbox://styles/relnox/cjl58dpkq2jjp2rmzyrdvfsds?fresh=true","blue":"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"}},"GEOGRID":{"features":[],"properties":{"geogrid_to_tui_mapping":{},"header":{"cellSize":50,"latitude":42.3664655,"longitude":-71.0854323,"ncols":20,"nrows":20,"rotation":0,"projection":"+proj=lcc +lat_1=42.68333333333333 +lat_2=41.71666666666667 +lat_0=41 +lon_0=-71.5 +x_0=200000 +y_0=750000 +ellps=GRS80 +datum=NAD83 +units=m +no_def"},"types":{"Institutional":{"LBCS":[{"proportion":0.3,"use":{"6700":1}},{"proportion":0.7,"use":{"2310":0.3,"4100":0.7}}],"NAICS":[{"proportion":0.3,"use":{"7121":1}},{"proportion":0.7,"use":{"6111":0.3,"6113":0.1,"6115":0.1,"6116":0.2,"8133":0.15,"8134":0.15}}],"interactive":"Web","color":"#1F78B4","height":4,"sqm_pperson":400},"Light Industrial":{"LBCS":[{"proportion":1,"use":{"3110":1}}],"NAICS":[{"proportion":1,"use":{"3336":0.5,"5413":0.1,"5417":0.4}}],"interactive":"Web","color":"#CAB2D6","height":4,"sqm_pperson":50},"Office":{"LBCS":[{"proportion":1,"use":{"2310":1}}],"NAICS":[{"proportion":1,"use":{"5400":1}}],"interactive":"Web","color":"#E31A1C","height":10,"sqm_pperson":20},"Park":{"LBCS":[{"proportion":1,"use":{"7240":1}}],"NAICS":null,"interactive":"Web","color":"#B2DF8A","sqm_pperson":1},"Parking":{"LBCS":[{"proportion":1,"use":{"5210":1}}],"NAICS":null,"interactive":"Web","color":"#646464","height":1,"sqm_pperson":4},"Residential":{"LBCS":[{"proportion":1,"use":{"1100":1}}],"NAICS":null,"interactive":"Web","color":"#FFFF33","height":4,"sqm_pperson":90},"Retail":{"LBCS":[{"proportion":1,"use":{"2100":0.6,"2200":0.4}}],"NAICS":[{"proportion":1,"use":{"4451":0.02,"4453":0.02,"7224":0.26,"7225":0.7}}],"interactive":"Web","color":"#FB9A99","height":4,"sqm_pperson":150},"Campus":{"LBCS":[{"proportion":1,"use":{"2310":1}}],"NAICS":[{"proportion":1,"use":{"3336":0.5,"5414":0.2,"5415":0.1,"5417":0.2}}],"interactive":"Web","color":"#E31A1C","height":10,"sqm_pperson":50},"Industrial":{"LBCS":[{"proportion":1,"use":{"3110":1}}],"NAICS":[{"proportion":1,"use":{"4841":0.2,"5617":0.3,"5619":0.3,"8111":0.2}}],"interactive":"Web","color":"#6A3D9A","height":4,"sqm_pperson":60},"Low Income housing":{"LBCS":[{"proportion":0.1,"use":{"2200":1}},{"proportion":0.75,"use":{"2310":1}},{"proportion":0.15,"use":{"1200":1}}],"NAICS":[{"proportion":0.1,"use":{"7224":0.5,"7225":0.5}},{"proportion":0.75,"use":{"5414":0.4,"5415":0.2,"5417":0.4}},{"proportion":0.15,"use":{"7211":1}}],"interactive":"Web","color":"#E31A1C","height":20,"sqm_pperson":50},"Residential Low Density":{"LBCS":[{"proportion":1,"use":{"1100":1}}],"NAICS":null,"interactive":"Web","color":"#FFFF33","height":4,"sqm_pperson":320}}},"type":"FeatureCollection"}}')},626:function(e,t){},629:function(e,t,a){},688:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(35),o=a.n(i),l=a(65),s=a(66),c=a(69),u=a(68),d=a(32),p=function(e){var t=e.children,a=e.store;return r.a.createElement(d.a,{store:a},t)},m=(a(589),a(140)),h=a(17);function f(e){return{type:"LISTEN_TO_ABM_SLIDERS",data:e}}function g(e){return{type:"LISTEN_TO_EDIT_MENU",data:e}}function E(e){return{type:"LISTEN_TO_ROW_EDIT",data:e}}function v(e){return{type:"LISTEN_TO_BASE_MAP_CENTER",data:e}}for(var b=a(57),y=Object.keys(b.menu.toggles),S=[],O=0;O<y.length;O++)Object.values(b.menu.toggles)[O].showOnInit&&S.push(y[O]);var D={MENU:S,CITYIO:{},MAP:{},SLIDERS:{time:[b.map.layers.ABM.startSimHour,b.map.layers.ABM.startSimHour,b.map.layers.ABM.endSimHour],speed:b.map.layers.ABM.animationSpeed},ACCESS_TOGGLE:0,SELECTED_TYPE:null,READY:!1,LOADING:!1,ROW_EDIT:null,BASE_MAP_CENTER:{latCenter:null,lonCenter:null},TYPES_LIST:null,GRID_CREATED:null};function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_CITYIO_DATA":return Object(h.a)(Object(h.a)({},e),{},{CITYIO:t.data});case"MENU_INTERACTION":return Object(h.a)(Object(h.a)({},e),{},{MENU:t.data});case"LISTEN_TO_MAP_EVENTS":return Object(h.a)(Object(h.a)({},e),{},{MAP:t.data});case"LISTEN_TO_ABM_SLIDERS":return Object(h.a)(Object(h.a)({},e),{},{SLIDERS:t.data});case"LISTEN_TO_ACCESS_TOGGLE":return Object(h.a)(Object(h.a)({},e),{},{ACCESS_TOGGLE:t.data});case"LISTEN_TO_EDIT_MENU":return Object(h.a)(Object(h.a)({},e),{},{SELECTED_TYPE:t.data});case"SET_READY_STATE":return Object(h.a)(Object(h.a)({},e),{},{READY:t.data});case"SET_LOADING_STATE":return Object(h.a)(Object(h.a)({},e),{},{LOADING:t.data});case"LISTEN_TO_ROW_EDIT":return Object(h.a)(Object(h.a)({},e),{},{ROW_EDIT:t.data});case"LISTEN_TO_TYPES_LIST":return Object(h.a)(Object(h.a)({},e),{},{TYPES_LIST:t.data});case"LISTEN_TO_GRID_CREATOR":return Object(h.a)(Object(h.a)({},e),{},{GRID_CREATED:t.data});case"LISTEN_TO_BASE_MAP_CENTER":return Object(h.a)(Object(h.a)({},e),{},{BASE_MAP_CENTER:t.data});default:return e}}var w=window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__(),I=function(){return Object(m.d)(T,w)},j=a(165),C=a(168),_=a.n(C),A=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).handleURL=function(){"mockAPI"===n.props.tableName?n.cityioURL=b.cityIO.mockURL:n.cityioURL=b.cityIO.baseURL+n.props.tableName,n.getCityIOHash(n.cityioURL+"/meta"),n.timer=setInterval((function(){n._isMounted&&n.getCityIOHash(n.cityioURL+"/meta")}),b.cityIO.interval),console.log("starting cityIO GET interval every "+b.cityIO.interval+"ms ")},n.getCityIOHash=function(e){_.a.get(e).then((function(e){n.handleCityIOHashes(e.data)})).catch((function(e){console.log(e)}))},n.handleCityIOHashes=function(e){e.id!==n.state.oldHashs.id&&(n.setState({cityIOmodulesStatus:{}}),n.props.setLoadingState(!0),b.cityIO.cityIOmodules.forEach((function(t){e.hashes[t]!==n.state.oldHashs[t]?(n.setNestedState("cityIOmodulesStatus",t,!1),n.getCityIOmoduleData(t,n.cityioURL+"/"+t),n.setNestedState("oldHashs",t,e.hashes[t])):n.setNestedState("cityIOmodulesStatus",t,!0)})),n.setNestedState("oldHashs","id",e.id))},n.setNestedState=function(e,t,a){var r=Object(h.a)({},n.state[e]);r[t]=a,n.setState(Object(j.a)({},e,r))},n.getCityIOmoduleData=function(e,t){_.a.get(t).then((function(t){n.setNestedState("cityIOmodulesData",e,t.data),console.log("...updating module:",e),n.checkDoneCityIO(e)})).catch((function(e){e.response?console.log("error.response:","\n",e.response.data,"\n",e.response.status,"\n",e.response.headers):e.request?console.log("error.request:",e.request):console.log("misc error:",e.message),console.log("request config:",e.config)}))},n.checkDoneCityIO=function(e){for(var t in n.setNestedState("cityIOmodulesStatus",e,!0),n.state.cityIOmodulesStatus)if(!0!==n.state.cityIOmodulesStatus[t])return;var a=n.state.cityIOmodulesData;a.tableName=n.props.tableName,n.props.getCityioData(a),console.log("done updating from cityIO"),n.props.setReadyState(!0),n.props.setLoadingState(!1)},n.state={oldHashs:{},cityIOmodulesData:{}},n.cityioURL=null,n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this._isMounted=!0,this.handleURL()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){return null}}]),a}(n.Component),M={getCityioData:function(e){return{type:"GET_CITYIO_DATA",data:e}},setReadyState:function(e){return{type:"SET_READY_STATE",data:e}},setLoadingState:function(e){return{type:"SET_LOADING_STATE",data:e}}},R=Object(d.b)(null,M)(A),N=a(169),k=a(75),G=a(115),L=a(465),x=a(746),P=a(693),F=a(720),B=a(690),W=a(466),U=a(718),z=a(719),V=a(745);function Y(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}var q=function(e){return/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/i.test(e)},H=function(e){var t=e.GEOGRID;if(e.GEOGRIDDATA&&e.GEOGRIDDATA.length===e.GEOGRID.features.length)for(var a=e.GEOGRIDDATA,n=0;n<t.features.length;n++)t.features[n].properties=a[n],t.features[n].properties.id=n;return JSON.parse(JSON.stringify(t))},J=function(e){for(var t=e.access,a=t.features.map((function(e){return e.geometry.coordinates})),n=t.features.map((function(e){return e.properties})),r=[],i=0;i<a.length;i++)r.push({coordinates:a[i],values:n[i]});return r};var X=Object(d.b)((function(e){return{cityioData:e.CITYIO}}),null)((function(e){var t=Object(L.a)((function(e){return{drawer:{width:300,zIndex:e.zIndex.drawer+1},marginAutoContainer:{width:"100%",display:"flex"},marginAutoItem:{margin:"auto",width:"80%"}}}))(),a=r.a.useState(null),n=Object(k.a)(a,2),i=n[0],o=n[1],l=Object(d.c)(),s=Object(d.d)((function(e){return e.SELECTED_TYPE})),c=s?s.height:null,u=[{value:0,label:"0 floors"},{value:50,label:"50 floors"}];return r.a.createElement(G.a,{className:t.drawer,variant:"persistent",anchor:"right",open:!0,classes:{paper:t.drawer}},r.a.createElement(P.a,null,function(e){var a=[];return Object.keys(e).forEach((function(n){var d=e[n].color;q(d)&&(d=Y(d));var p="rgb("+d[0]+","+d[1]+","+d[2]+")",m=i===n,f=!1;e[n].height&&(f=!0),a.push(r.a.createElement(r.a.Fragment,{key:Math.random()},r.a.createElement(U.a,{key:Math.random(),variant:"inset",component:"li",classes:{root:t.dividerColor}}),r.a.createElement(B.a,{key:Math.random(),alignItems:"flex-start",button:!0,variant:"raised",selected:m,onClick:function(t){return a=n,(r=e[n]).name=a,o(a),void l(g(r));var a,r},className:t.list},r.a.createElement(z.a,{key:Math.random()},r.a.createElement(V.a,{style:{backgroundColor:p}},n.charAt(0))),r.a.createElement(W.a,{key:Math.random(),classes:{primary:t.listItemPrimaryText,secondary:t.listItemSecondaryText},primary:n})),f&&r.a.createElement("div",{className:t.marginAutoContainer},r.a.createElement("div",{className:t.marginAutoItem},r.a.createElement(F.a,{in:m,key:Math.random()},r.a.createElement(x.a,{key:Math.random(),value:c,valueLabelDisplay:"auto",className:t.slider,onChangeCommitted:function(e,t){return l(g(Object(h.a)(Object(h.a)({},s),{},{height:t})))},getAriaLabel:function(e){return e.toString()},min:0,max:50,marks:u}))))))})),a}(e.cityioData.GEOGRID.properties.types)))})),K=a(150),Q=a(722),Z=Object(L.a)({root:{width:"80%",marginLeft:28},subtitle1:{marginTop:12},subtitle2:{marginTop:12}});var $=function(){var e=Z(),t=Object(d.d)((function(e){return e.SLIDERS})),a=Object(d.c)();return r.a.createElement("div",{className:e.root},r.a.createElement(K.a,{className:e.subtitle1,variant:"subtitle2",id:"range-slider",gutterBottom:!0},"Simulation Range"),r.a.createElement(x.a,{min:0,max:86400,marks:[{value:0,label:"12AM"},{value:21600,label:"6AM"},{value:43200,label:"12PM"},{value:64800,label:"6PM"},{value:86400,label:"12AM"}],value:t.time,onChange:function(e,n){a(f(Object(h.a)(Object(h.a)({},t),{},{time:n})))},valueLabelDisplay:"off","aria-labelledby":"range-slider"}),r.a.createElement(K.a,{className:e.subtitle2,variant:"subtitle2",id:"continuous-slider",gutterBottom:!0},"Simulation Speed"),r.a.createElement(x.a,{min:0,max:100,value:t.speed,onChange:function(e,n){a(f(Object(h.a)(Object(h.a)({},t),{},{speed:n})))},valueLabelDisplay:"auto","aria-labelledby":"continuous-slider"}))},ee=Object(L.a)({root:{width:"80%",marginLeft:28},subtitle1:{marginTop:12},subtitle2:{marginTop:12}});var te=function(){var e=ee(),t=Object(d.d)((function(e){return e.SLIDERS})),a=Object(d.c)();return r.a.createElement("div",{className:e.root},r.a.createElement(K.a,{className:e.subtitle1,variant:"subtitle2",id:"range-slider",gutterBottom:!0},"Time of day"),r.a.createElement(x.a,{min:0,max:86400,marks:[{value:0,label:"12AM"},{value:21600,label:"6AM"},{value:43200,label:"12PM"},{value:64800,label:"6PM"},{value:86400,label:"12AM"}],value:t.time,onChange:function(e,n){a(f(Object(h.a)(Object(h.a)({},t),{},{time:n})))},valueLabelDisplay:"off","aria-labelledby":"range-slider"}))},ae=a(723),ne=a(81);var re=function(e){var t=Object(d.d)((function(e){return e.ACCESS_TOGGLE})),a=e.cityioData,n=a&&a.access&&a.access.properties?a.access.properties:[],i=Object(d.c)(),o=b.map.layers.heatmap.colors,l=o.length-1;return r.a.createElement(P.a,null,r.a.createElement(B.a,null,r.a.createElement(ne.b,{width:500,startColor:"rgb("+o[0][0]+","+o[0][1]+","+o[0][2]+")",endColor:"rgb("+o[l][0]+","+o[l][1]+","+o[l][2]+")",startTitle:"No Access",endTitle:"Full Access"})),n.map((function(e,a){return r.a.createElement(B.a,{key:e},r.a.createElement(W.a,{primary:e,style:{textTransform:"capitalize"}}),r.a.createElement(Q.a,null,r.a.createElement(ae.a,{edge:"end",checked:t===a,onChange:function(){i({type:"LISTEN_TO_ACCESS_TOGGLE",data:a})}})))})))};var ie=function(e){for(var t=Object(L.a)((function(e){return{drawer:{display:"flex",paddingLeft:16,paddingRight:16,width:350,padding:e.spacing(0,1)},drawerPaper:{width:350}}}))(),a=e.open,n=e.toggleDrawer,i=e.handleToggle,o=Object(d.d)((function(e){return{menuState:e.MENU,cityioData:e.CITYIO}})),l=o.menuState,s=o.cityioData,c=b.menu.toggles,u=Object.keys(c),p=[],m=Object.keys(s),h=0;h<u.length;h++){var f=c[u[h]].requireModule,g=!!l.includes(u[h]);if(m.includes(f)||!1===f){var E=r.a.createElement("div",{key:u[h]},r.a.createElement(B.a,null,r.a.createElement(W.a,{primary:c[u[h]].displayName}),r.a.createElement(Q.a,null,r.a.createElement(ae.a,{edge:"end",onChange:i(u[h]),checked:g}))),"SHADOWS"===u[h]&&r.a.createElement(F.a,{in:g,style:{width:"100%"}},r.a.createElement(te,null)),"ABM"===u[h]&&r.a.createElement(F.a,{in:g,style:{width:"100%"}},r.a.createElement($,null)),"ACCESS"===u[h]&&r.a.createElement(F.a,{in:g,style:{width:"80%",marginLeft:24}},r.a.createElement(re,{cityioData:s})));p.push(E)}}return r.a.createElement(G.a,{elevation:3,className:t.drawer,classes:{paper:t.drawerPaper},BackdropProps:{invisible:!0},anchor:"left",open:a,onClose:n},r.a.createElement(P.a,{className:t.list},r.a.createElement(B.a,null,r.a.createElement(K.a,{variant:"h6",gutterBottom:!0},"MIT CityScope")),r.a.createElement(B.a,null,r.a.createElement(K.a,{variant:"caption",gutterBottom:!0},"Toggle layers visibility")),p))},oe=a(724),le=a(518),se=a.n(le),ce=a(520),ue=a.n(ce),de=a(519),pe=a.n(de),me=a(522),he=a.n(me),fe=a(521),ge=a.n(fe),Ee=a(475);function ve(e){var t=Object(L.a)({root:{display:"flex",flexDirection:"column",position:"fixed",paddingLeft:16,paddingTop:8,zIndex:1}})(),a=Object(d.d)((function(e){return e.MENU})),n=e.handleToggle,i=e.toggleDrawer;return r.a.createElement(P.a,{className:t.root},r.a.createElement(B.a,null,r.a.createElement(Ee.a,{title:"Open Layer + Settings Menu"},r.a.createElement(oe.a,{color:"secondary",onClick:i},r.a.createElement(se.a,null)))),r.a.createElement(B.a,null,r.a.createElement(Ee.a,{title:"Toggle Edit Grid Mode, send to cityIO"},r.a.createElement(oe.a,{color:"secondary",onClick:n("EDIT")},a.includes("EDIT")?r.a.createElement(pe.a,{style:{color:"e91e63"}}):r.a.createElement(ue.a,null)))),r.a.createElement(B.a,null,r.a.createElement(Ee.a,{title:"Reset View/Toggle Ortho"},r.a.createElement(oe.a,{color:"secondary",onClick:n("RESET_VIEW")},a.includes("RESET_VIEW")?r.a.createElement(ge.a,null):r.a.createElement(he.a,null)))))}var be=function(){var e=Object(d.d)((function(e){return e.MENU})),t=Object(d.c)(),a=r.a.useState({drawerOpen:!1}),n=Object(k.a)(a,2),i=n[0],o=n[1],l=function(){o(Object(h.a)(Object(h.a)({},i),{},{drawerOpen:!i.drawerOpen}))},s=function(a){return function(){var n=e.indexOf(a),r=Object(N.a)(e);-1===n?r.push(a):r.splice(n,1),t({type:"MENU_INTERACTION",data:r})}},c=e&&e.includes("EDIT");return r.a.createElement("div",null,r.a.createElement(ie,{open:i.drawerOpen,toggleDrawer:l,handleToggle:s}),r.a.createElement(ve,{toggleDrawer:l,handleToggle:s}),c&&r.a.createElement(X,{key:"EDIT"}))},ye=function(e){if(!e.mousePos)return null;var t=e.mousePos;return r.a.createElement("div",{style:{borderRadius:"15%",position:"fixed",pointerEvents:"none",backgroundColor:"rgba(0,0,0,0.5)",padding:"1vw",color:"rgba(255,255,255,0.9)",zIndex:1,left:t.clientX,top:t.clientY,fontSize:"0.65em",fontWeight:500}},r.a.createElement("p",null,"Type:",e.hoveredObj.object.properties.name),r.a.createElement("p",null,"Floors:",e.hoveredObj.object.properties.height),r.a.createElement("p",null,"ID:",e.hoveredObj.object.properties.id))},Se=a(523),Oe=a.n(Se),De=function(e){if(!e.mousePos||!e.hoveredCells)return null;var t=e.selectedType,a=e.hoveredCells.object.properties.interactive,n=e.mousePos,i=e.divSize,o=t.color;q(o)&&(o=Y(o));var l="rgb("+o[0]+","+o[1]+","+o[2]+")",s="rgba("+o[0]+","+o[1]+","+o[2]+",0.6)",c=n.clientX-i/2,u=n.clientY-i/2,d=a?t.name:"Not-interactive";return r.a.createElement("div",{style:{border:"2px solid",backgroundColor:e.mouseDown?s:"rgba(0,0,0,0)",borderColor:l,color:l,borderRadius:"15%",position:"fixed",zIndex:1,pointerEvents:"none",width:i,height:i,left:c,top:u}},r.a.createElement("div",{style:{position:"relative",left:i+10,fontSize:"0.8em"}},!a&&r.a.createElement(Oe.a,null),d,":"))},Te=a(340),we=a(744),Ie=a(728),je=(a(477),a(740)),Ce=a(741),_e=a(353),Ae=a(695),Me=a(511),Re=a(250),Ne=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e))._onViewStateChange=function(e){var t=e.viewState;t.orthographic=!!n.props.menu.includes("RESET_VIEW"),n.setState({viewState:t})},n._updateSunDirecation=function(e){var t=new Date;t.setHours(0,0,0,0);var a=new Date(t.getTime()+1e3*e);n._effects[0].directionalLights[0].timestamp=Date.UTC(a.getFullYear(),a.getMonth(),a.getDay(),a.getHours(),a.getMinutes(),a.getSeconds())},n._mulipleObjPicked=function(e){var t=n.state.pickingRadius,a=e.x-t/2,r=e.y-t/2;return n.deckGL.pickObjects({x:a,y:r,width:t,height:t})},n._handleGridcellEditing=function(e){var t=n.props.selectedType,a=t.height,r=t.color,i=t.name,o=n._mulipleObjPicked(e);o.forEach((function(e){var t=e.object.properties;t&&t.interactive&&(t.color=q(r)?Y(r):r,t.height=a,t.name=i)})),n.setState({selectedCellsState:o})},n._renderPaintBrush=function(){return n.props.menu.includes("EDIT")?n.props.selectedType&&r.a.createElement(De,{mousePos:n.state.mousePos,selectedType:n.props.selectedType,divSize:n.state.pickingRadius,mouseDown:n.state.mouseDown,hoveredCells:n.state.hoveredObj}):n.state.hoveredObj&&r.a.createElement(ye,{mousePos:n.state.mousePos,hoveredObj:n.state.hoveredObj})},n._handleKeyUp=function(){n.setState({keyDownState:null})},n._handleKeyDown=function(e){n.setState({keyDownState:e.nativeEvent.key})},n._remapValues=function(e){return e>15&&e<25?3:e<15&&e>10?12:30},n.state={menu:[],cityioData:null,selectedType:null,draggingWhileEditing:!1,selectedCellsState:null,pickingRadius:40,viewState:b.map.initialViewState},n.animationFrame=null,n}return Object(s.a)(a,[{key:"componentWillUnmount",value:function(){this.animationFrame&&window.cancelAnimationFrame(this.animationFrame)}},{key:"componentDidMount",value:function(){this._rightClickViewRotate(),this._setupSunEffects(),this._setViewStateToTableHeader(),this._animate()}},{key:"componentDidUpdate",value:function(e,t){this._updateSunDirecation(this.props.sliders.time[1]),e.menu!==t.menu&&this.setState({menu:this.props.menu});var a=this.props.cityioData;if(t.cityioData!==a&&(this.setState({cityioData:a,GEOGRID:H(a)}),a.access&&this.setState({access:J(a)})),!e.menu.includes("ABM")&&this.props.menu.includes("ABM")?this.setState({animateABM:!0}):e.menu.includes("ABM")&&!this.props.menu.includes("ABM")&&this.setState({animateABM:!1}),!e.menu.includes("ROTATE")&&this.props.menu.includes("ROTATE")?this.setState({animateCamera:!0}):e.menu.includes("ROTATE")&&!this.props.menu.includes("ROTATE")&&this.setState({animateCamera:!1}),!e.menu.includes("SHADOWS")&&this.props.menu.includes("SHADOWS")&&(this._effects[0].shadowColor=[0,0,0,.5]),e.menu.includes("SHADOWS")&&!this.props.menu.includes("SHADOWS")&&(this._effects[0].shadowColor=[0,0,0,0]),e.menu.includes("EDIT")&&!this.props.menu.includes("EDIT")){for(var n=[],r=0;r<this.state.GEOGRID.features.length;r++)n[r]=this.state.GEOGRID.features[r].properties;!function(e,t,a){var n={method:"post",url:"https://cityio.media.mit.edu/api/table/update/"+t+a,data:e,headers:{"Content-Type":"application/json",Accept:"application/json"}};_()(n).catch((function(e){console.log(e),console.log("ERROR:",e)}))}(n,a.tableName,"/GEOGRIDDATA")}!e.menu.includes("RESET_VIEW")&&this.props.menu.includes("RESET_VIEW")?this._setViewStateToTableHeader():e.menu.includes("RESET_VIEW")&&!this.props.menu.includes("RESET_VIEW")&&this.setState({viewState:Object(h.a)(Object(h.a)({},this.state.viewState),{},{pitch:45})})}},{key:"_setViewStateToTableHeader",value:function(){var e=this.props.cityioData.GEOGRID.properties.header;this.setState({viewState:Object(h.a)(Object(h.a)({},this.state.viewState),{},{longitude:e.longitude,latitude:e.latitude,zoom:15,pitch:0,bearing:360-e.rotation,orthographic:!0})})}},{key:"_setupSunEffects",value:function(){var e=new Ae.a({color:[255,255,255],intensity:.85}),t=new Me.a({timestamp:15549272e5,color:[255,255,255],intensity:1,_shadow:!0}),a=new Re.a({ambientLight:e,dirLight:t});a.shadowColor=[0,0,0,.5],this._effects=[a]}},{key:"_animate",value:function(){if(this.state.animateCamera){var e=this.state.viewState.bearing?this.state.viewState.bearing:0;e<360?e+=.05:e=0,this.setState({viewState:Object(h.a)(Object(h.a)({},this.state.viewState),{},{bearing:e})})}if(this.state.animateABM){var t=this.props.sliders.time[1],a=this.props.sliders.speed,n=this.props.sliders.time[0],r=this.props.sliders.time[2],i=parseInt(t)+parseInt(a);(t<n||t>r)&&(i=n),this.props.listenToSlidersEvents(Object(h.a)(Object(h.a)({},this.props.sliders),{},{time:[this.props.sliders.time[0],i,this.props.sliders.time[2]]})),this._updateSunDirecation(i)}this.animationFrame=window.requestAnimationFrame(this._animate.bind(this))}},{key:"_rightClickViewRotate",value:function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(e){return e.preventDefault()}))}},{key:"_renderLayers",value:function(){var e=this,t=this.state.viewState.zoom,a=this.props,n=a.cityioData,r=a.selectedType,i=a.menu,o=[];return i.includes("GRID")&&o.push(new je.a({id:"GRID",data:this.state.GEOGRID,visible:!!i.includes("GRID"),pickable:!0,extruded:!0,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:2,getElevation:function(e){return e.properties.height},getFillColor:function(e){return e.properties.color},onClick:function(t){r&&i.includes("EDIT")&&"Shift"!==e.state.keyDownState&&e._handleGridcellEditing(t)},onDrag:function(t){r&&i.includes("EDIT")&&"Shift"!==e.state.keyDownState&&e._handleGridcellEditing(t)},onDragStart:function(){r&&i.includes("EDIT")&&"Shift"!==e.state.keyDownState&&e.setState({draggingWhileEditing:!0})},onHover:function(t){t.object&&e.setState({hoveredObj:t})},onDragEnd:function(){e.setState({draggingWhileEditing:!1})},updateTriggers:{getFillColor:this.state.selectedCellsState,getElevation:this.state.selectedCellsState},transitions:{getFillColor:500,getElevation:500}})),i.includes("ACCESS")&&o.push(new Ce.a({id:"ACCESS",visible:i.includes("ACCESS"),colorRange:b.map.layers.heatmap.colors,radiusPixels:200,opacity:.25,data:this.state.access,getPosition:function(e){return e.coordinates},getWeight:function(t){return t.values[e.props.accessToggle]},updateTriggers:{getWeight:[this.props.accessToggle]}})),i.includes("ABM")&&o.push(new Ie.a({id:"ABM",visible:!!i.includes("ABM"),data:n.ABM,getPath:function(e){return e.path},getTimestamps:function(e){return e.timestamps},getColor:function(e){switch(e.mode[0]){case 0:return[228,26,28];case 1:return[55,126,184];case 2:return[77,175,74];case 3:return[255,255,51];case 4:return[152,78,163];case 5:return[255,127,0];default:return[255,255,255]}},getWidth:1,widthScale:this._remapValues(t),opacity:.8,rounded:!0,trailLength:500,currentTime:this.props.sliders.time[1]})),i.includes("AGGREGATED_TRIPS")&&o.push(new _e.a({id:"AGGREGATED_TRIPS",visible:!!i.includes("AGGREGATED_TRIPS"),_shadow:!1,data:n.ABM,getPath:function(e){var t=Math.random()<.5?5e-5*Math.random():-5e-5*Math.random();for(var a in e.path)e.path[a][0]=e.path[a][0]+t,e.path[a][1]=e.path[a][1]+t,e.path[a][2]=2*e.mode[0];return e.path},getColor:function(e){switch(e.mode[0]){case 0:return[228,26,28];case 1:return[55,126,184];case 2:return[77,175,74];case 3:return[255,255,51];case 4:return[152,78,163];case 5:return[255,127,0];default:return[255,255,255]}},opacity:.2,getWidth:1.5})),o}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"baseMap",onKeyDown:this._handleKeyDown,onKeyUp:this._handleKeyUp,onMouseMove:function(t){return e.setState({mousePos:t.nativeEvent})},onMouseUp:function(){return e.setState({mouseDown:!1})},onMouseDown:function(){return e.setState({mouseDown:!0})}},r.a.createElement(r.a.Fragment,null,this._renderPaintBrush()),r.a.createElement(we.a,{ref:function(t){e.deckGL=t&&t.deck},viewState:this.state.viewState,onViewStateChange:this._onViewStateChange,layers:this._renderLayers(),effects:this._effects,controller:{touchZoom:!0,touchRotate:!0,dragPan:!this.state.draggingWhileEditing,dragRotate:!this.state.draggingWhileEditing,keyboard:!1}},r.a.createElement(Te.a,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:b.map.mapStyle.blue,preventStyleDiffing:!0})))}}]),a}(n.Component),ke={listenToSlidersEvents:f},Ge=Object(d.b)((function(e){return{cityioData:e.CITYIO,sliders:e.SLIDERS,menu:e.MENU,accessToggle:e.ACCESS_TOGGLE,selectedType:e.SELECTED_TYPE}}),ke)(Ne),Le=a(628).solve,xe=function(e,t){for(var a=[],n=[],r=0,i=e.length;r<i;++r){var o=Object(k.a)(e[r],2),l=o[0],s=o[1],c=Object(k.a)(t[r],2),u=c[0],d=c[1];a.push([l,s,1,0,0,0,-l*u,-s*u],[0,0,0,l,s,1,-l*d,-s*d]),n.push(u,d)}var p=Le(a,n,!0);return[p[0],p[3],0,p[6],p[1],p[4],0,p[7],0,0,1,0,p[2],p[5],0,1].map((function(e){return function(e,t){var a=Math.pow(10,t),n=e*a;return Math.round(n)/a}(e,10)}))},Pe=function(e){return"matrix3d(".concat(e.join(", "),")")},Fe=function(e){return"translate(".concat(e[0],"px, ").concat(e[1],"px)")},Be={container:{width:30,height:30,borderRadius:"50%",position:"absolute",border:"4px solid white",cursor:"move"},"top-left":{left:-15,top:-15},"bottom-left":{left:-15,bottom:-15},"top-right":{top:-15,right:-15},"bottom-right":{bottom:-15,right:-15}},We=function(e){var t=e.position,a=e.translation,r=e.onMouseEnter,i=e.onMouseDown,o=e.onMouseUp,l=e.className,s=void 0===l?"":l,c=e.style,u=void 0===c?{}:c;return n.createElement("div",{onMouseEnter:function(){return r&&r(t)},onMouseDown:function(e){return i(e,t)},onMouseUp:function(){return o(t)},className:s,style:Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)({},Be.container),Be[t]),u),{},{transform:Fe(a)})})},Ue=a(481),ze=a(730),Ve=a(530),Ye=a.n(Ve),qe=Object(L.a)((function(e){return{button:{margin:e.spacing(1),position:"fixed",top:"50vh",zIndex:1e3}}}));function He(){var e=qe();return r.a.createElement(ze.a,{container:!0,alignItems:"center",justify:"center"},r.a.createElement(Ue.a,{variant:"contained",color:"secondary",className:e.button,startIcon:r.a.createElement(Ye.a,null)},"Reset Projection Mapping"))}var Je={position:"relative"},Xe=["top-left","top-right","bottom-right","bottom-left"],Ke=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Qe=function(){var e={};return Xe.forEach((function(t){e[t]=[0,0]})),e},Ze=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).container=void 0,e.layerTranslateDelta=void 0,e.anchorTranslateDelta=void 0,e.isAnchorDragging=!1,e.targetPoints=void 0,e.anchorMoving=void 0,e.state={matrix:Ke,translateDelta:Qe(),sourcePoints:void 0,transformOrigin:[0,0],containerTranslate:[e.props.x||0,e.props.y||0]},e.onAnchorMouseDown=function(t,a){t.stopPropagation(),e.anchorTranslateDelta=[t.pageX-e.state.translateDelta[a][0],t.pageY-e.state.translateDelta[a][1]],e.anchorMoving=a},e.onAnchorMouseMove=function(t){if(e.anchorTranslateDelta&&e.state.sourcePoints&&e.anchorMoving){t.preventDefault(),t.stopPropagation();var a=Xe.indexOf(e.anchorMoving),n=t.pageX-e.anchorTranslateDelta[0],r=t.pageY-e.anchorTranslateDelta[1];e.targetPoints[a]=[e.state.sourcePoints[a][0]+n,e.state.sourcePoints[a][1]+r],e.setState({matrix:xe(e.state.sourcePoints,e.targetPoints),translateDelta:Object(h.a)(Object(h.a)({},e.state.translateDelta),{},Object(j.a)({},e.anchorMoving,[n,r]))})}},e.onAnchorMouseUp=function(t){e.anchorTranslateDelta=void 0,e.anchorMoving=void 0},e.onMouseUp=function(){e.layerTranslateDelta=void 0},e.onMouseMove=function(t){if(e.layerTranslateDelta&&e.props.isEditMode){var a=[t.pageX-e.layerTranslateDelta[0],t.pageY-e.layerTranslateDelta[1]];e.setState({containerTranslate:a})}},e.onMouseDown=function(t){var a=e.state.containerTranslate;e.layerTranslateDelta=[t.pageX-a[0],t.pageY-a[1]]},e._clearLocalStraoge=function(){localStorage.getItem("projMap")&&localStorage.removeItem("projMap"),window.location.reload()},e}return Object(s.a)(a,[{key:"componentDidMount",value:function(){if(window.addEventListener("mousemove",this.onAnchorMouseMove),window.addEventListener("mousemove",this.onMouseMove),this.container){var e=this.container.getBoundingClientRect(),t=e.width,a=e.height,n=[[0,0],[t,0],[t,a],[0,a]];this.targetPoints=[].concat(n),this.setState({sourcePoints:n})}}},{key:"componentDidUpdate",value:function(e,t){if(!e.isEditMode&&this.props.isEditMode){if(localStorage.getItem("projMap")){console.log("loading prev. projMap...");var a=localStorage.getItem("projMap");this.setState(JSON.parse(a))}}else e.isEditMode&&!this.props.isEditMode&&(console.log("saving edited projMap..."),localStorage.setItem("projMap",JSON.stringify(t)))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousemove",this.onAnchorMouseMove),window.removeEventListener("mousemove",this.onMouseMove)}},{key:"render",value:function(){var e=this,t=this.props,a=t.style,r=t.isEditMode,i=t.className,o=t.anchorStyle,l=t.anchorClassName,s=this.state,c=s.translateDelta,u=s.matrix,d=s.containerTranslate,p=s.transformOrigin;return n.createElement(n.Fragment,null,r&&n.createElement("div",{onClick:function(){return e._clearLocalStraoge()}},n.createElement(He,null)),n.createElement("div",{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,style:{cursor:r?"all-scroll":"inherit",position:"relative",display:"inline-block",transform:Fe(d)}},n.createElement("div",{ref:function(t){e.container=t},style:Object(h.a)(Object(h.a)(Object(h.a)({},Je),a),{},{pointerEvents:r?"none":"all",transform:Pe(u),transformOrigin:"".concat(p[0],"px ").concat(p[1],"px 0px")}),className:i},this.props.children),r&&n.createElement("div",null,Xe.map((function(t,a){return n.createElement(We,{style:o,className:l,key:t,translation:c[t],position:t,onMouseDown:e.onAnchorMouseDown,onMouseUp:e.onAnchorMouseUp})})))))}}]),a}(n.Component),$e=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r)))._checkKeystone=function(){return!!e.props.menu.includes("KEYSTONE")},e}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{style:{height:"100vh",width:"100vw",overflow:"hidden"}},r.a.createElement(Ze,{style:{height:"100vh",width:"100vw"},isEditMode:this._checkKeystone()},r.a.createElement(Ge,{menu:this.props.menu,selectedType:this.props.selectedType})))}}]),a}(n.Component),et=Object(d.b)((function(e){return{menu:e.MENU,selectedType:e.SELECTED_TYPE}}),null)($e),tt=(a(482),a(629),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={domains:[],radarData:[]},n.radarSize=n.props.drawerWidth-50,n.colorRange=["#fc03ec","#79C7E3"],n}return Object(s.a)(a,[{key:"generateData",value:function(){for(var e=this.props.cityioData.indicators,t={},a={},n=[],r=0;r<e.length;r++)"radar"===e[r].viz_type&&(t[e[r].name]=[e[r].value],a[e[r].name]=[e[r].ref_value],e[r].domain=[0,1],n.push(e[r]));this.setState({radarData:[t,a],domains:n})}},{key:"componentDidMount",value:function(){this.setState({indicators:this.props.indicators}),this.generateData()}},{key:"componentDidUpdate",value:function(e){e.cityioData.indicators!==this.props.cityioData.indicators&&(this.setState({indicators:this.props.indicators}),console.log("new radar data.."),this.generateData())}},{key:"render",value:function(){return this.props.cityioData.indicators?r.a.createElement("div",null,r.a.createElement(ne.f,{className:"Radar blur",animation:!0,data:this.state.radarData,domains:this.state.domains,colorRange:this.colorRange,style:{polygons:{fillOpacity:.2,strokeWidth:2},axes:{text:{opacity:0,fontWeight:700,fill:"white"},strokeWidth:0},labels:{textAnchor:"middle",fontSize:10,fill:"white"}},margin:{left:this.radarSize/6,top:this.radarSize/6,bottom:this.radarSize/6,right:this.radarSize/6},width:this.radarSize,height:this.radarSize},r.a.createElement(ne.a,{style:{fill:"white",fillOpacity:.1,backgroundColor:"#FFF",opacity:.5,stroke:"white",width:.1},tickValues:Object(N.a)(new Array(11)).map((function(e,t){return t/10-1}))})),r.a.createElement(ne.c,{items:["Design","Reference"],colors:this.colorRange})):null}}]),a}(n.Component)),at=a(531),nt=a.n(at),rt=Object(L.a)((function(e){return{root:{"& > *":{margin:e.spacing(1)}}}}));function it(e){var t=rt();return r.a.createElement("div",{className:t.root},r.a.createElement(Ue.a,{onClick:function(){!function(e){var t=JSON.stringify(e),a=document.createElement("a"),n=new Blob([t],{type:"text/plain"});a.href=URL.createObjectURL(n),a.download="data.json",document.body.appendChild(a),a.click()}(e)},size:"small",variant:"outlined",color:"secondary",className:t.button,startIcon:r.a.createElement(nt.a,null)},e.title))}var ot=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={barChartData:null,hoverdNode:null},n.colorRange=["#fc03ec","#79C7E3"],n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.generateData()}},{key:"generateData",value:function(){for(var e=this.props.cityioData.indicators,t=[],a=0;a<e.length;a++)"bar"===e[a].viz_type&&t.push({x:e[a].name,y:e[a].value});this.setState({barChartData:t})}},{key:"componentDidUpdate",value:function(e){e.cityioData.indicators!==this.props.cityioData.indicators&&this.generateData()}},{key:"render",value:function(){var e=this,t=this.state.hoveredNode;return r.a.createElement(r.a.Fragment,null,this.state.barChartData&&r.a.createElement("div",null,t&&r.a.createElement(K.a,{gutterBottom:!0},t.x," : ",t.y),r.a.createElement(ne.d,{opacity:.2,xType:"ordinal",width:this.props.drawerWidth-50,height:this.props.drawerWidth-50,stackBy:"y",yDomain:[0,1]},r.a.createElement(ne.i,{style:{text:{fill:"#FFF"}},tickLabelAngle:90}),r.a.createElement(ne.j,{style:{text:{fill:"#FFF"}}}),r.a.createElement(ne.h,{animation:!0,onValueMouseOver:function(t){e.setState({hoveredNode:t})},data:this.state.barChartData}),r.a.createElement(ne.h,{animation:!0,onValueMouseOver:function(t){e.setState({hoveredNode:t})},data:this.state.refChartData})),r.a.createElement(it,{data:this.props.cityioData.indicators,title:"radar & bars data"})))}}]),a}(n.Component);function lt(e){var t=e.drawerWidth-100,a=Object(n.useState)(!1),i=Object(k.a)(a,2),o=i[0],l=i[1],s=Object(L.a)((function(t){return{list:{width:e.drawerWidth-50}}}))(),c=function(){var t=e.cityioData.GEOGRID.properties.header.cellSize,a=e.cityioData.GEOGRIDDATA,n={};a.forEach((function(e){var a=e.name;if("None"!==e.name)if(n.hasOwnProperty(a)){n[a].count=n[a].count+1;var r=e.height<1?1:e.height;n[a].area=n[a].area+r*t}else n[a]={},n[a].area=0,n[a].count=0,n[a].name=a,n[a].color=function(e,t,a){function n(e){var t=e.toString(16);return 1===t.length?"0"+t:t}return"#"+n(e)+n(t)+n(a)}(e.color[0],e.color[1],e.color[2])}));var r=[];for(var i in n)r.push(n[i]);return{children:r,color:1}}();return r.a.createElement(P.a,{className:s.list},r.a.createElement(B.a,null,o.name?r.a.createElement(K.a,{gutterBottom:!0},o.name,": ",o.area," sqm"):r.a.createElement(K.a,{gutterBottom:!0},"Hover on chart...")),r.a.createElement(B.a,null,r.a.createElement(ne.g,{colorType:"literal",animation:!0,className:"donut-chart-example",innerRadius:t/2-t/5,radius:t/2,getLabel:function(e){return e.name},labelsRadiusMultiplier:.95,labelsStyle:{textAnchor:"middle",fontSize:11,fill:"#FFF",textShadow:"2px 2px 2px #000"},showLabels:!0,getAngle:function(e){return e.area},data:c.children,onValueMouseOver:function(e){return l(e)},onSeriesMouseOut:function(){return l(!1)},width:t,height:t,padAngle:.01},!1!==o&&r.a.createElement(ne.e,{value:o},r.a.createElement("div",{style:{background:"rgba(0,0,0,0.8)",fontSize:14}},r.a.createElement(K.a,{variant:"caption",gutterBottom:!0},"Area: ",o.area," sqm"))))),r.a.createElement(B.a,null,r.a.createElement(it,{data:c.children,title:"area data"})))}var st=a(254);var ct=Object(d.b)((function(e){return{cityioData:e.CITYIO,menu:e.MENU}}),null)((function(e){var t=Object(L.a)((function(e){return{paper:{display:"flex","& > *":{margin:e.spacing(1)}},drawerPaper:{width:450}}}))(),a=e.menu&&e.menu.includes("RADAR");return r.a.createElement(r.a.Fragment,null,a&&r.a.createElement(G.a,{variant:"persistent",anchor:"right",open:!0,classes:{paper:t.drawerPaper}},r.a.createElement(P.a,{className:t.list},r.a.createElement(B.a,null,r.a.createElement(K.a,{variant:"h6",gutterBottom:!0},"Urban Indicators")),r.a.createElement("div",{className:t.paper},r.a.createElement(st.a,{elevation:10},r.a.createElement(B.a,null,r.a.createElement(tt,{cityioData:e.cityioData,drawerWidth:450})))),r.a.createElement("div",{className:t.paper},r.a.createElement(st.a,{elevation:10},r.a.createElement(B.a,null,r.a.createElement(ot,{cityioData:e.cityioData,drawerWidth:450})))),r.a.createElement("div",{className:t.paper},r.a.createElement(st.a,{elevation:10},r.a.createElement(B.a,null,r.a.createElement(lt,{cityioData:e.cityioData,drawerWidth:450})))))))})),ut=a(532),dt=a(395),pt=a(534),mt=a.n(pt);function ht(){var e=Object(ut.a)(["\n    display: block;\n    margin: 0 auto;\n    border-color: none;\n"]);return ht=function(){return e},e}var ft=Object(dt.css)(ht());var gt=function(){var e=Object(d.d)((function(e){return e.LOADING}));return r.a.createElement("div",{style:{position:"fixed",bottom:50,right:50,zIndex:1}},r.a.createElement(mt.a,{css:ft,size:20,color:"white",loading:e}))};function Et(e){var t=Object(d.d)((function(e){return e.READY})),a=e.tableName;return r.a.createElement(r.a.Fragment,null,r.a.createElement(R,{tableName:a}),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement(be,null),r.a.createElement(et,null),r.a.createElement(ct,null)),r.a.createElement(gt,null))}var vt=a(738),bt=a(204),yt=a(739),St=a(535),Ot=a.n(St),Dt=a(731),Tt=Object(L.a)((function(e){return{root:{display:"flex",flexWrap:"wrap",margin:"auto",padding:e.spacing(2),width:"100%",maxWidth:"50%"},inputRoot:{fontSize:40},labelRoot:{fontSize:30,color:"white","&$labelFocused":{color:"white"}},labelFocused:{fontSize:15}}}));function wt(){var e=Tt();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:e.root},r.a.createElement(K.a,{variant:"h2",gutterBottom:!0},"CityScopeJS"),r.a.createElement("div",null,r.a.createElement(Dt.a,{href:"https://github.com/CityScope/CS_cityscopeJS"},"",r.a.createElement(Ue.a,{color:"default"},r.a.createElement(Ot.a,null)))),r.a.createElement(K.a,{variant:"h5",gutterBottom:!0},"CityScopeJS is a unified front-end for MIT CityScope project, an open-source urban modeling and simulation platform. CityScopeJS allows users to examine different urban-design alternatives, and observe their impact through multiple layers of urban analytics modules, such as economy, traffic and ABM simulation, urban access, storm-water, noise and more.")))}function It(e){if(!e.mousePos)return null;var t=e.mousePos,a=e.selectedType,n=e.divSize,i="rgba("+a.color[0]+","+a.color[1]+","+a.color[2]+",0.6)",o=t.clientX-n/2,l=t.clientY-n/2;return r.a.createElement("div",{style:{border:"2px solid",backgroundColor:e.mouseDown?i:"rgba(0,0,0,0)",borderColor:a.color,color:a.color,borderRadius:"15%",position:"fixed",zIndex:1,pointerEvents:"none",width:n,height:n,left:o,top:l}},r.a.createElement("div",{style:{position:"relative",left:n+10,fontSize:"0.5em"}},a.name))}var jt=a(59),Ct=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null},_t=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e))._toggleOrthoView=function(e){e.orthographic=!!n.props.menu.includes("RESET_VIEW")},n._onViewStateChange=function(e){var t=e.viewState;n.setState({viewState:t})},n.componentDidUpdate=function(e){n.props.mapCenter!==e.mapCenter&&n.setState({viewState:Object(h.a)(Object(h.a)({},n.state.viewState),{},{latitude:n.props.mapCenter.latCenter,longitude:n.props.mapCenter.lonCenter,pitch:0,bearing:0,orthographic:!1})})},n._mulipleObjPicked=function(e){var t=n.state.pickingRadius,a=e.x-t/2,r=e.y-t/2;return n.deckGL.pickObjects({x:a,y:r,width:t,height:t})},n._handleGridcellEditing=function(e){if(n.props.selectedType){var t=n.props.selectedType,a=t.height,r=t.name,i=t.color,o=t.interactive,l=n._mulipleObjPicked(e);l.forEach((function(e){var t=e.object.properties;t.color=Ct(i),t.height=parseInt(a),t.name=r,"No"!==o?t.interactive=o:delete t.interactive})),n.setState({selectedCellsState:l})}},n._renderSelectionTarget=function(){return n.props.selectedType&&r.a.createElement(It,{mousePos:n.state.mousePos,selectedType:n.props.selectedType,divSize:n.state.pickingRadius,mouseDown:n.state.mouseDown})},n._handleKeyUp=function(){n.setState({keyDownState:null})},n._handleKeyDown=function(e){n.setState({keyDownState:e.nativeEvent.key})},n.state={selectedType:null,draggingWhileEditing:!1,selectedCellsState:null,pickingRadius:40,viewState:jt.map.initialViewState},n.dirLightSettings={timestamp:Date.UTC(2019,7,1,12),color:[255,255,255],intensity:1,_shadow:!0},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this._rightClickViewRotate(),this._setupEffects(),this._setViewStateToTableHeader()}},{key:"_setViewStateToTableHeader",value:function(){this.setState({viewState:Object(h.a)(Object(h.a)({},this.state.viewState),{},{latitude:jt.GEOGRID.properties.header.latitude,longitude:jt.GEOGRID.properties.header.longitude,zoom:15,pitch:0,bearing:0,orthographic:!0})})}},{key:"_setupEffects",value:function(){var e=new Ae.a({color:[255,255,255],intensity:.85}),t=new Me.a(this.dirLightSettings),a=new Re.a({ambientLight:e,dirLight:t});a.shadowColor=[0,0,0,.5],this._effects=[a]}},{key:"_rightClickViewRotate",value:function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(e){return e.preventDefault()}))}},{key:"_renderLayers",value:function(){var e=this,t=[];return t.push(new je.a({id:"GRID",opacity:.5,stroked:!1,filled:!0,wireframe:!0,data:this.props.createdGrid,visible:!0,pickable:!0,extruded:!0,lineWidthScale:1,lineWidthMinPixels:1,getElevation:function(e){return e.properties.height},getFillColor:function(e){return e.properties.color},onClick:function(t,a){a.rightButton||"Shift"===e.state.keyDownState||e._handleGridcellEditing(t)},onDrag:function(t,a){a.rightButton||"Shift"===e.state.keyDownState||e._handleGridcellEditing(t)},onDragStart:function(t,a){a.rightButton||"Shift"===e.state.keyDownState||e.setState({draggingWhileEditing:!0})},onDragEnd:function(){e.setState({draggingWhileEditing:!1})},updateTriggers:{getFillColor:this.state.selectedCellsState,getElevation:this.state.selectedCellsState},transitions:{getFillColor:500,getElevation:500}})),t}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"baseMap",onKeyDown:this._handleKeyDown,onKeyUp:this._handleKeyUp,onMouseMove:function(t){return e.setState({mousePos:t.nativeEvent})},onMouseUp:function(){return e.setState({mouseDown:!1})},onMouseDown:function(){return e.setState({mouseDown:!0})}},this._renderSelectionTarget(),r.a.createElement(we.a,{ref:function(t){e.deckGL=t&&t.deck},viewState:this.state.viewState,onViewStateChange:this._onViewStateChange,layers:this._renderLayers(),effects:this._effects,controller:{touchZoom:!0,touchRotate:!0,dragPan:!this.state.draggingWhileEditing,dragRotate:!this.state.draggingWhileEditing,keyboard:!1}},r.a.createElement(Te.a,{dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:jt.map.mapStyle.sat,preventStyleDiffing:!0})))}}]),a}(n.Component),At={listenToBaseMapCenter:v},Mt=Object(d.b)((function(e){return{selectedType:e.ROW_EDIT,mapCenter:e.BASE_MAP_CENTER,createdGrid:e.GRID_CREATED}}),At)(_t),Rt=a(536),Nt=a.n(Rt);function kt(){var e=r.a.useState({columns:[{title:"Type",field:"name"},{title:"Height",field:"height",type:"numeric"},{title:"Interactive",field:"interactive",lookup:{No:"No",Web:"Web",TUI:"TUI"}},{title:"Color",field:"color",type:"string"},{title:"LBCS",field:"LBCS",type:"string"},{title:"NAICS",field:"NAICS",type:"string"}],data:function(e){var t=[];return Object.keys(e).forEach((function(a){t.push({name:a,color:e[a].color,height:e[a].height?e[a].height:null,LBCS:JSON.stringify(e[a].LBCS),NAICS:JSON.stringify(e[a].NAICS),interactive:e[a].interactive})})),t}(jt.GEOGRID.properties.types)}),t=Object(k.a)(e,2),a=t[0],i=t[1];Object(n.useEffect)((function(){o({type:"LISTEN_TO_TYPES_LIST",data:a.data})}));var o=Object(d.c)(),l=Object(n.useState)(null),s=Object(k.a)(l,2),c=s[0],u=s[1],p=Object(n.useState)(null),m=Object(k.a)(p,2),f=m[0],g=m[1];return r.a.createElement("div",{style:{maxWidth:"100%"}},r.a.createElement(ze.a,{container:!0},r.a.createElement(ze.a,{item:!0,xs:12},r.a.createElement(Nt.a,{title:"Types Editor",columns:a.columns,data:a.data,options:{paging:!1,search:!1,selection:!1,rowStyle:function(e){return{backgroundColor:c===e.tableData.id?f:null}}},onRowClick:function(e,t){u(t.tableData.id),g(t.color),o(E(t))},editable:{onRowAdd:function(e){return new Promise((function(t){setTimeout((function(){t(),i((function(t){var a=Object(N.a)(t.data);return a.push(e),Object(h.a)(Object(h.a)({},t),{},{data:a})}))}),600)}))},onRowUpdate:function(e,t){return new Promise((function(a){setTimeout((function(){a(),t&&i((function(a){var n=Object(N.a)(a.data);return n[n.indexOf(t)]=e,Object(h.a)(Object(h.a)({},a),{},{data:n})})),o(E(e))}),600)}))},onRowDelete:function(e){return new Promise((function(t){setTimeout((function(){t(),i((function(t){var a=Object(N.a)(t.data);return a.splice(a.indexOf(e),1),Object(h.a)(Object(h.a)({},t),{},{data:a})}))}),600)}))}}}))))}var Gt=a(494),Lt=a(538),xt=a.n(Lt),Pt=a(263);function Ft(e){return e*Math.PI/180}function Bt(e){return 180*e/Math.PI}var Wt=function(e){var t=Object.keys(e);return e[t[t.length*Math.random()<<0]]};function Ut(e){var t=Object(d.c)(),a=function(){var a=function(e){for(var t=parseFloat(e.longitude),a=parseFloat(e.latitude),n=parseFloat(e.rotation),r=e.projection,i=parseFloat(e.cellSize),o=parseFloat(e.nrows),l=parseFloat(e.ncols),s=Pt.a.defs("EPSG:4326"),c={lon:t,lat:a},u=(90-n+360)%360,d=i*l/6371e3,p=Ft(c.lat),m=Ft(c.lon),h=Ft(u),f=Math.asin(Math.sin(p)*Math.cos(d)+Math.cos(p)*Math.sin(d)*Math.cos(h)),g={lon:Bt(m+Math.atan2(Math.sin(h)*Math.sin(d)*Math.cos(p),Math.cos(d)-Math.sin(p)*Math.sin(f))),lat:Bt(f)},E=Object(Pt.a)(s,r,[c.lon,c.lat]),v=Object(Pt.a)(s,r,[g.lon,g.lat]),b=(v[1]-E[1])/(v[0]-E[0]),y=Math.atan(b),S=Math.cos(y),O=Math.sin(y),D=[],T=[],w=0;w<o;w++)for(var I=0;I<l;I++)D.push(I*i),T.push(-w*i);for(var j=[],C=[],_=0;_<D.length;_++)j.push(D[_]*S-T[_]*O),C.push(D[_]*O+T[_]*S);for(var A=[],M=[],R=0;R<j.length;R++)A.push(E[0]+j[R]),M.push(E[1]+C[R]);for(var N=A[1]-A[0],k=M[1]-M[0],G=A[l]-A[0],L=M[l]-M[0],x=[],P={type:"FeatureCollection",features:[]},F=jt.GEOGRID.properties.types,B=0;B<A.length;B++){for(var W=Wt(F),U={type:"Feature",geometry:{type:"Polygon",coordinates:null},properties:{color:Ct(W.color),height:W.height,name:W.name,interactive:W.interactive}},z=[[A[B],M[B]],[A[B]+G,M[B]+L],[A[B]+G+N,M[B]+L+k],[A[B]+N,M[B]+k],[A[B],M[B]]],V=[],Y=0;Y<5;Y++){var q=Object(Pt.a)(r,s,z[Y]);V.push(q)}U.geometry.coordinates=[V],x.push(U)}return P.features=x,P}(e.gridProps);t({type:"LISTEN_TO_GRID_CREATOR",data:a})};return r.a.createElement(Ue.a,{onClick:function(){a()},variant:"outlined",color:"default",startIcon:r.a.createElement(xt.a,null)},"Create Grid")}var zt=a(539),Vt=a.n(zt),Yt=a(540),qt=a.n(Yt),Ht=function(e,t,a,n){var r=e,i={};return t.forEach((function(e){i[e.name]=e})),r.properties.types=i,r.properties.header=n,r.properties.header.longitude=parseFloat(r.properties.header.longitude),r.properties.header.latitude=parseFloat(r.properties.header.latitude),r.properties.header.rotation=parseFloat(r.properties.header.rotation),r.properties.header.nrows=parseFloat(r.properties.header.nrows),r.properties.header.ncols=parseFloat(r.properties.header.ncols),r.properties.header.cellSize=parseFloat(r.properties.header.cellSize),r.features=a,r};function Jt(e){var t=r.a.useState(null),a=Object(k.a)(t,2),n=a[0],i=a[1],o=Object(d.d)((function(e){return e})),l=o.GRID_CREATED,s=function(){var t=jt.GEOGRID,a=o.TYPES_LIST,n=o.GRID_CREATED.features,l=e.gridProps,s=Ht(t,a,n,l),c=s.properties.header.tableName.toLowerCase(),u={geoGridURL:"https://cityio.media.mit.edu/api/table/update/"+c+"/GEOGRID",geoGridDataURL:"https://cityio.media.mit.edu/api/table/update/"+c+"/GEOGRIDDATA"},d={method:"post",url:u.geoGridURL,data:s,headers:{"Content-Type":"application/json",Accept:"application/json"}};_()(d).then((function(e){i(function(e,t){var a="https://cityscope.media.mit.edu/CS_cityscopeJS/?cityscope="+t;return r.a.createElement(K.a,{variant:"caption"},"CityIO is ",e.data.status,". Grid deployed to"," ",r.a.createElement(Dt.a,{href:a},a))}(e,c))})).then((function(){d.url=u.geoGridDataURL,d.data={},_()(d),console.log("removed GEOGRIDDATA")})).catch((function(e){console.log("ERROR:",e)}))};return r.a.createElement(r.a.Fragment,null,l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Ue.a,{onClick:function(){s()},variant:"outlined",color:"default",startIcon:r.a.createElement(Vt.a,null)},"Commit Grid to cityIO"),r.a.createElement(Ue.a,{onClick:function(){!function(){var t=jt.GEOGRID,a=o.TYPES_LIST,n=o.GRID_CREATED.features,r=e.gridProps,i=Ht(t,a,n,r),l="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(i)),s=document.createElement("a");s.setAttribute("href",l),s.setAttribute("download","grid.json"),document.body.appendChild(s),s.click(),s.remove()}()},variant:"outlined",color:"default",startIcon:r.a.createElement(qt.a,null)},"Download JSON"),r.a.createElement("div",{style:{width:"100%"}}," ",n)))}var Xt=a(541),Kt=a.n(Xt);function Qt(e){var t=Object(d.c)();return r.a.createElement(Ue.a,{onClick:function(){t(v({latCenter:parseFloat(e.mapCenter[0]),lonCenter:parseFloat(e.mapCenter[1])}))},variant:"outlined",color:"default",startIcon:r.a.createElement(Kt.a,null),style:{fontSize:"12px"}},"Center Map")}function Zt(){var e=Object(L.a)((function(e){return{root:{"& .MuiTextField-root":{margin:e.spacing(1),flexWrap:"wrap"},"& > *":{margin:e.spacing(1)}},paper:{width:"100%"}}})),t=r.a.useState({tableName:"CityScopeJS",latitude:jt.GEOGRID.properties.header.latitude,longitude:jt.GEOGRID.properties.header.longitude,nrows:jt.GEOGRID.properties.header.nrows,ncols:jt.GEOGRID.properties.header.nrows,rotation:jt.GEOGRID.properties.header.rotation,cellSize:jt.GEOGRID.properties.header.cellSize,projection:jt.GEOGRID.properties.header.projection}),a=Object(k.a)(t,2),n=a[0],i=a[1],o=function(e){var t=e.target,a=t.id,r=t.value;i(Object(h.a)(Object(h.a)({},n),{},Object(j.a)({},a,r)))},l=e();return r.a.createElement(st.a,{elevation:3,className:l.paper},r.a.createElement("form",{className:l.root,noValidate:!0,autoComplete:"off"},r.a.createElement(K.a,{variant:"h6"},"Grid Properties"),r.a.createElement("div",{className:l.root},r.a.createElement(Gt.a,{onChange:function(e){return o(e)},variant:"outlined",className:l.textField,id:"tableName",label:"CityScope Project Name",defaultValue:n.tableName})),r.a.createElement("div",{className:l.root},r.a.createElement(Gt.a,{onChange:function(e){return o(e)},variant:"outlined",className:l.textField,id:"latitude",label:"Latitude",defaultValue:n.latitude,type:"number"}),r.a.createElement(Gt.a,{onChange:function(e){return o(e)},variant:"outlined",className:l.textField,id:"longitude",label:"Longitude",defaultValue:n.longitude,type:"number"})),r.a.createElement("div",{className:l.root},r.a.createElement(Qt,{mapCenter:[n.latitude,n.longitude]})),r.a.createElement("div",{className:l.root},r.a.createElement(Gt.a,{onChange:function(e){return o(e)},variant:"outlined",className:l.textField,id:"nrows",label:"Rows",defaultValue:n.nrows,type:"number",InputProps:{inputProps:{max:100,min:0}}}),r.a.createElement(Gt.a,{onChange:function(e){return o(e)},variant:"outlined",className:l.textField,id:"ncols",label:"Columns",defaultValue:n.ncols,type:"number",InputProps:{inputProps:{max:100,min:0}}}),r.a.createElement(Gt.a,{onChange:function(e){return o(e)},variant:"outlined",className:l.textField,id:"rotation",label:"Rotation (deg)",defaultValue:n.rotation,type:"number",InputProps:{inputProps:{max:360,min:0}}}),r.a.createElement(Gt.a,{onChange:function(e){return o(e)},variant:"outlined",className:l.textField,id:"cellSize",label:"Cell Size (m^2)",defaultValue:n.cellSize,type:"number",InputProps:{inputProps:{max:1e3,min:0}}})),r.a.createElement("div",{className:l.root},r.a.createElement(Gt.a,{onChange:function(e){return o(e)},variant:"outlined",id:"projection",label:"Projection",defaultValue:n.projection,type:"string",helperText:"Note: wrong projection might break app. Find the relevant projection at: https://epsg.io/"})),r.a.createElement("div",{className:l.root},r.a.createElement(Ut,{gridProps:n}),r.a.createElement(Jt,{gridProps:n}))))}function $t(){var e=Object(L.a)((function(e){return{drawer:{width:"50%"}}}))();return r.a.createElement(G.a,{className:e.drawer,variant:"persistent",anchor:"right",open:!0,classes:{paper:e.drawer}},r.a.createElement(P.a,null,r.a.createElement(B.a,null,r.a.createElement(K.a,{variant:"h5"},"CityScope Grid Editor")),r.a.createElement(B.a,null,r.a.createElement(K.a,{variant:"caption"},"Tool for creating CityScope endpoints with virtual editable girds, types, and props, and deploy them to cityIO.")),r.a.createElement(B.a,null,r.a.createElement(Zt,null)),r.a.createElement(B.a,null,r.a.createElement(kt,null))))}var ea=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Mt,null),r.a.createElement($t,null))}}]),a}(n.Component),ta=Object(bt.a)({palette:{type:"dark",background:{default:"#000",paper:"#29323c"}}}),aa=function(){var e=window.location.toString(),t="cityscope=",a=e.substring(e.indexOf(t)+t.length),n=null;return console.log(window.location.search),-1!==e.indexOf(t)&&a.length>0?(console.log("Loading CityScope project: "+a),n=r.a.createElement(Et,{tableName:a})):n="?editor"===window.location.search?r.a.createElement(ea,null):r.a.createElement(wt,null),n},na=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return r.a.createElement(vt.a,{theme:ta},r.a.createElement(yt.a,null),r.a.createElement(p,{store:I()},r.a.createElement(aa,null)))}}]),a}(n.Component),ra=document.getElementById("root");o.a.render(r.a.createElement(na,null),ra)}},[[581,1,2]]]);
//# sourceMappingURL=main.cfe15608.chunk.js.map