/*! For license information please see main.81671885.chunk.js.LICENSE.txt */
(this.webpackJsonpcityscopejs=this.webpackJsonpcityscopejs||[]).push([[0],{426:function(e,t){},43:function(e){e.exports=JSON.parse('{"docsURL":"https://raw.githubusercontent.com/CityScope/CS_cityscopeJS/master/docs/","cityIO":{"baseURL":"https://cityio.media.mit.edu/api/table/","interval":500,"cityIOmodules":[{"name":"header","expectUpdate":false},{"name":"GEOGRID","expectUpdate":false},{"name":"ABM2","expectUpdate":true},{"name":"grid","expectUpdate":false},{"name":"access","expectUpdate":true},{"name":"GEOGRIDDATA","expectUpdate":false},{"name":"indicators","expectUpdate":true}]},"menu":{"toggles":{"GRID":{"displayName":"Interactive Grid","showOnInit":true,"requireModule":"GEOGRID"},"ABM":{"displayName":"Mobility Simulation","showOnInit":false,"requireModule":"ABM2"},"AGGREGATED_TRIPS":{"displayName":"Aggregated Trips","showOnInit":false,"requireModule":"ABM2"},"ACCESS":{"displayName":"Accessibility Analysis","showOnInit":false,"requireModule":"access"},"RADAR":{"displayName":"Urban Indicators","showOnInit":false,"requireModule":"indicators"},"ROTATE":{"displayName":"Rotate Camera","showOnInit":false,"requireModule":false},"SHADOWS":{"displayName":"Toggle Shadows","showOnInit":true,"requireModule":"GEOGRID"},"KEYSTONE":{"displayName":"Projection Mapping","showOnInit":false,"requireModule":false}}},"map":{"mapStyle":{"sat":"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true","dark":"mapbox://styles/relnox/cjl58dpkq2jjp2rmzyrdvfsds?fresh=true","blue":"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"},"layers":{"ABM":{"startSimHour":0,"endSimHour":86400,"currentSimHour":43200,"animationSpeed":20},"heatmap":{"colors":[[255,0,130],[0,150,255]]}},"initialViewState":{"zoom":17,"pitch":0,"bearing":0}}}')},603:function(e,t,a){e.exports=a(711)},611:function(e,t,a){},62:function(e){e.exports=JSON.parse('{"map":{"mapStyle":{"sat":"mapbox://styles/relnox/cjs9rb33k2pix1fo833uweyjd?fresh=true","dark":"mapbox://styles/relnox/cjl58dpkq2jjp2rmzyrdvfsds?fresh=true","blue":"mapbox://styles/relnox/ck0h5xn701bpr1dqs3he2lecq?fresh=true"}},"GEOGRID":{"features":[],"properties":{"geogrid_to_tui_mapping":{},"header":{"cellSize":50,"latitude":42.3664655,"longitude":-71.0854323,"ncols":20,"nrows":20,"rotation":0,"projection":"+proj=lcc +lat_1=42.68333333333333 +lat_2=41.71666666666667 +lat_0=41 +lon_0=-71.5 +x_0=200000 +y_0=750000 +ellps=GRS80 +datum=NAD83 +units=m +no_def"},"types":{"Institutional":{"LBCS":[{"proportion":0.3,"use":{"6700":1}},{"proportion":0.7,"use":{"2310":0.3,"4100":0.7}}],"NAICS":[{"proportion":0.3,"use":{"7121":1}},{"proportion":0.7,"use":{"6111":0.3,"6113":0.1,"6115":0.1,"6116":0.2,"8133":0.15,"8134":0.15}}],"interactive":"Web","color":"#1F78B4","height":4,"sqm_pperson":400},"Light Industrial":{"LBCS":[{"proportion":1,"use":{"3110":1}}],"NAICS":[{"proportion":1,"use":{"3336":0.5,"5413":0.1,"5417":0.4}}],"interactive":"Web","color":"#CAB2D6","height":4,"sqm_pperson":50},"Office":{"LBCS":[{"proportion":1,"use":{"2310":1}}],"NAICS":[{"proportion":1,"use":{"5400":1}}],"interactive":"Web","color":"#E31A1C","height":10,"sqm_pperson":20},"Park":{"LBCS":[{"proportion":1,"use":{"7240":1}}],"NAICS":null,"interactive":"Web","color":"#B2DF8A","sqm_pperson":1},"Parking":{"LBCS":[{"proportion":1,"use":{"5210":1}}],"NAICS":null,"interactive":"Web","color":"#646464","height":1,"sqm_pperson":4},"Residential":{"LBCS":[{"proportion":1,"use":{"1100":1}}],"NAICS":null,"interactive":"Web","color":"#FFFF33","height":4,"sqm_pperson":90},"Retail":{"LBCS":[{"proportion":1,"use":{"2100":0.6,"2200":0.4}}],"NAICS":[{"proportion":1,"use":{"4451":0.02,"4453":0.02,"7224":0.26,"7225":0.7}}],"interactive":"Web","color":"#FB9A99","height":4,"sqm_pperson":150},"Campus":{"LBCS":[{"proportion":1,"use":{"2310":1}}],"NAICS":[{"proportion":1,"use":{"3336":0.5,"5414":0.2,"5415":0.1,"5417":0.2}}],"interactive":"Web","color":"#E31A1C","height":10,"sqm_pperson":50},"Industrial":{"LBCS":[{"proportion":1,"use":{"3110":1}}],"NAICS":[{"proportion":1,"use":{"4841":0.2,"5617":0.3,"5619":0.3,"8111":0.2}}],"interactive":"Web","color":"#6A3D9A","height":4,"sqm_pperson":60},"Low Income housing":{"LBCS":[{"proportion":0.1,"use":{"2200":1}},{"proportion":0.75,"use":{"2310":1}},{"proportion":0.15,"use":{"1200":1}}],"NAICS":[{"proportion":0.1,"use":{"7224":0.5,"7225":0.5}},{"proportion":0.75,"use":{"5414":0.4,"5415":0.2,"5417":0.4}},{"proportion":0.15,"use":{"7211":1}}],"interactive":"Web","color":"#E31A1C","height":20,"sqm_pperson":50},"Residential Low Density":{"LBCS":[{"proportion":1,"use":{"1100":1}}],"NAICS":null,"interactive":"Web","color":"#FFFF33","height":4,"sqm_pperson":320}}},"type":"FeatureCollection"}}')},649:function(e,t){},651:function(e,t,a){},711:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(37),i=a.n(o),l=a(86),c=a(87),s=a(89),u=a(88),d=a(25),p=function(e){var t=e.children,a=e.store;return r.a.createElement(d.a,{store:a},t)},m=(a(611),a(145)),f=a(90),h=a(17);function E(e){return{type:"GET_CITYIO_DATA",data:e}}function g(e){return{type:"LISTEN_TO_ABM_SLIDERS",data:e}}function v(e){return{type:"LISTEN_TO_EDIT_MENU",data:e}}function b(e){return{type:"SET_READY_STATE",data:e}}function O(e){return{type:"SET_LOADING_STATE",data:e}}function y(e){return{type:"SET_SCENARIO_NAMES",data:e}}function S(e){return{type:"ADD_LOADING_MODULES",data:e}}function j(e){return{type:"REMOVE_LOADING_MODULES",data:e}}function D(e){return{type:"LISTEN_TO_ROW_EDIT",data:e}}function C(e){return{type:"LISTEN_TO_BASE_MAP_CENTER",data:e}}for(var I=a(43),T=Object.keys(I.menu.toggles),w=[],A=0;A<T.length;A++)Object.values(I.menu.toggles)[A].showOnInit&&w.push(T[A]);var N={MENU:w,CITYIO:{},SCENARIO_NAMES:[],MAP:{},LOADING_MODULES:[],SLIDERS:{time:[I.map.layers.ABM.startSimHour,I.map.layers.ABM.currentSimHour,I.map.layers.ABM.endSimHour],speed:I.map.layers.ABM.animationSpeed},ABM_MODE:"mode",ACCESS_TOGGLE:0,SELECTED_TYPE:null,READY:!1,LOADING:!1,ROW_EDIT:null,BASE_MAP_CENTER:{latCenter:null,lonCenter:null},TYPES_LIST:null,GRID_CREATED:null};function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_CITYIO_DATA":return Object(h.a)(Object(h.a)({},e),{},{CITYIO:t.data});case"MENU_INTERACTION":return Object(h.a)(Object(h.a)({},e),{},{MENU:t.data});case"LISTEN_TO_MAP_EVENTS":return Object(h.a)(Object(h.a)({},e),{},{MAP:t.data});case"LISTEN_TO_ABM_SLIDERS":return Object(h.a)(Object(h.a)({},e),{},{SLIDERS:t.data});case"LISTEN_TO_ABM_MODE":return Object(h.a)(Object(h.a)({},e),{},{ABM_MODE:t.data});case"LISTEN_TO_ACCESS_TOGGLE":return Object(h.a)(Object(h.a)({},e),{},{ACCESS_TOGGLE:t.data});case"LISTEN_TO_EDIT_MENU":return Object(h.a)(Object(h.a)({},e),{},{SELECTED_TYPE:t.data});case"SET_READY_STATE":return Object(h.a)(Object(h.a)({},e),{},{READY:t.data});case"SET_LOADING_STATE":return Object(h.a)(Object(h.a)({},e),{},{LOADING:t.data});case"SET_SCENARIO_NAMES":return Object(h.a)(Object(h.a)({},e),{},{SCENARIO_NAMES:t.data});case"ADD_LOADING_MODULES":return Object(h.a)(Object(h.a)({},e),{},{LOADING_MODULES:Object(f.a)(new Set([].concat(Object(f.a)(e.LOADING_MODULES),Object(f.a)(t.data))))});case"REMOVE_LOADING_MODULES":return Object(h.a)(Object(h.a)({},e),{},{LOADING_MODULES:e.LOADING_MODULES.filter((function(e){return!t.data.includes(e)}))});case"LISTEN_TO_ROW_EDIT":return Object(h.a)(Object(h.a)({},e),{},{ROW_EDIT:t.data});case"LISTEN_TO_TYPES_LIST":return Object(h.a)(Object(h.a)({},e),{},{TYPES_LIST:t.data});case"LISTEN_TO_GRID_CREATOR":return Object(h.a)(Object(h.a)({},e),{},{GRID_CREATED:t.data});case"LISTEN_TO_BASE_MAP_CENTER":return Object(h.a)(Object(h.a)({},e),{},{BASE_MAP_CENTER:t.data});default:return e}}var R=window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__(),_=Object(m.d)(M,R),k=a(172),x=a(34),L=a(193),G=a.n(L),P=a(363),B=a(76),F=a.n(B),U=a(327),W=function(e,t,a){var n=I.cityIO.baseURL+e+"/meta/hashes";F.a.get(n).then((function(n){var r,o=Object.keys(n.data).filter((function(e){return e.includes("scenarios")})).map((function(e){return parseInt(e.replace("scenarios",""))})),i=[],l=Object(U.a)(o);try{for(l.s();!(r=l.n()).done;){var c=r.value;i.push(z(e,c))}}catch(s){l.e(s)}finally{l.f()}Promise.all(i).then((function(e){t(e.map((function(e){return{name:e.data.name,id:e.data.id}}))),a&&a(!1)})).catch((function(e){return console.log("error getting scenario names",e)}))})).catch((function(e){console.log("Error getting scenarios",e)}))},z=function(e,t){var a=I.cityIO.baseURL+e+"/scenarios"+t+"/info";return F.a.get(a)},V=function(){var e=Object(P.a)(G.a.mark((function e(t){var a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.a.get(t);case 3:return a=e.sent,e.abrupt("return",a.data);case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();function Y(e){var t=e.tableName,a=Object(n.useState)(null),r=Object(x.a)(a,2),o=r[0],i=r[1],l=Object(n.useState)({}),c=Object(x.a)(l,2),s=c[0],u=c[1],p=I.cityIO.baseURL+t,m=Object(d.d)((function(e){return e.CITYIO})),f=Object(d.c)();function g(){return v.apply(this,arguments)}function v(){return(v=Object(P.a)(G.a.mark((function e(){var t;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(p+"/meta/id");case 2:t=e.sent,o!==t&&i(t),setTimeout(g,I.cityIO.interval);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=Object(P.a)(G.a.mark((function e(){var a,n,r,o,i,l;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(p+"/meta/hashes");case 2:return a=e.sent,n=[],r=[],(o=I.cityIO.cityIOmodules.map((function(e){return e.name}))).forEach((function(e){s[e]!==a[e]?(n.push(V(p+"/"+e)),r.push(e)):n.push(null)})),f(S(r)),e.next=10,Promise.all(n);case 10:i=e.sent,u(a),(l=o.reduce((function(e,t,a){return i[a]?(console.log("updating ".concat(t)),Object(h.a)(Object(h.a)({},e),{},Object(k.a)({},t,i[a]))):e}),m)).tableName=t,f(j(r)),f(E(l)),console.log("done updating from cityIO"),f(b(!0)),f(O(!1));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){var e=setTimeout(g,I.cityIO.interval);return console.log("reading cityIO every"+I.cityIO.interval+"ms"),function(){return clearTimeout(e)}}),[]),Object(n.useEffect)((function(){o&&(f(O(!0)),W(t,(function(e){return f(y(e))})),function(){D.apply(this,arguments)}())}),[o]),null}var J=a(119),q=a(499),H=a(773),X=a(715),K=a(744),Q=a(713),Z=a(500),$=a(743),ee=a(772);function te(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}var ae=function(e){return/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/i.test(e)},ne=function(e,t,a){var n=new Set(I.cityIO.cityIOmodules.filter((function(e){return e.expectUpdate})).map((function(e){return e.name}))),r=new Set(Object.keys(_.getState().CITYIO)),o=Object(f.a)(r).filter((function(e){return n.has(e)})),i={method:"post",url:"https://cityio.media.mit.edu/api/table/update/"+t+a,data:e,headers:{"Content-Type":"application/json",Accept:"application/json"}};F()(i).then((function(e){"ok"===e.data.status&&_.dispatch(S(o))})).catch((function(e){console.log("ERROR:",e)}))},re=function(e,t,a,n,r){var o=t.height,i=t.color,l=t.name,c=function(e,t,a){var n=t,r=e.x-n/2,o=e.y-n/2;return a.current.pickObjects({x:r,y:o,width:n,height:n})}(e,n,r);c.forEach((function(e){var t=e.object.properties;t&&t.interactive&&(t.color=ae(i)?te(i):i,t.height=o,t.name=l)})),a(c)},oe=a(58),ie=a(130);function le(e){var t=["#85C4C8","#C22E00","#1E96BE","#EC9370","#F6D18A"],a=Object(n.useState)(!1),o=Object(x.a)(a,2),i=o[0],l=o[1],c=function(){var a=[];return e.typeInfo.forEach((function(e,n){a.push({angle:e.proportion,label:JSON.stringify(e.use),color:t[n]})})),a}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(oe.g,{colorType:"literal",animation:!0,className:"donut-chart-example",innerRadius:22.5,radius:37.5,getLabel:function(e){return e.label},showLabels:!1,getAngle:function(e){return e.angle},data:c,onValueMouseOver:function(e){l(e)},onSeriesMouseOut:function(){return l(!1)},width:75,height:75,padAngle:.1},!1!==i&&r.a.createElement(oe.e,{value:i},r.a.createElement("div",{style:{background:"rgba(0,0,0,0.8)",fontSize:14}},r.a.createElement(ie.a,{variant:"caption",gutterBottom:!0},i.label)))))}var ce=a(272),se=a(403);var ue=Object(d.b)((function(e){return{cityioData:e.CITYIO}}),null)((function(e){var t=Object(q.a)((function(e){return{drawer:{width:300,zIndex:e.zIndex.drawer+1},marginAutoContainer:{width:"100%",display:"flex",margin:"auto"},marginAutoItem:{margin:"auto",width:"80%",height:"80%"}}}))(),a=r.a.useState(null),n=Object(x.a)(a,2),o=n[0],i=n[1],l=Object(d.c)(),c=Object(d.d)((function(e){return e.SELECTED_TYPE})),s=c?c.height:null,u=[{value:0,label:"min"},{value:100,label:"max"}],p=function(e){return"string"==typeof e?JSON.parse(e):e};return r.a.createElement(J.a,{className:t.drawer,variant:"persistent",anchor:"right",open:!0,classes:{paper:t.drawer}},function(a){var n=[];return Object.keys(a).forEach((function(d,m){var f=a[d].color,E=p(e.cityioData.GEOGRID.properties.types[d].LBCS),g=p(e.cityioData.GEOGRID.properties.types[d].NAICS);ae(f)&&(f=te(f));var b="rgb("+f[0]+","+f[1]+","+f[2]+")",O=o===d,y=!1;a[d].height&&(y=!0),n.push(r.a.createElement(r.a.Fragment,{key:Math.random()},r.a.createElement(ce.a,{elevation:5},r.a.createElement(Q.a,{key:Math.random(),alignItems:"flex-start",button:!0,variant:"raised",selected:O,onClick:function(e){return t=d,(n=a[d]).name=t,i(t),void l(v(n));var t,n},className:t.list},r.a.createElement($.a,{key:Math.random()},r.a.createElement(ee.a,{style:{backgroundColor:b}},d.charAt(0))),r.a.createElement(Z.a,{key:Math.random(),classes:{primary:t.listItemPrimaryText,secondary:t.listItemSecondaryText},primary:d}))),y&&r.a.createElement(K.a,{in:O,key:Math.random()},r.a.createElement("div",{className:t.marginAutoContainer},r.a.createElement("div",{className:t.marginAutoItem},r.a.createElement(ce.a,{elevation:10},r.a.createElement(se.a,{display:"flex",flexDirection:"row",p:1,m:1},r.a.createElement(se.a,{p:1},E&&r.a.createElement(r.a.Fragment,null,r.a.createElement(ie.a,{gutterBottom:!0},"LBCS"),r.a.createElement(le,{typeInfo:E}))),r.a.createElement(se.a,{p:1},g&&r.a.createElement(r.a.Fragment,null,r.a.createElement(ie.a,{gutterBottom:!0},"NAICS"),r.a.createElement(le,{typeInfo:g})))),r.a.createElement("div",{className:t.marginAutoItem},r.a.createElement(ie.a,{gutterBottom:!0},"Set Height"),r.a.createElement(H.a,{key:Math.random(),value:s,valueLabelDisplay:"auto",className:t.slider,onChangeCommitted:function(e,t){return l(v(Object(h.a)(Object(h.a)({},c),{},{height:t})))},getAriaLabel:function(e){return e.toString()},min:u[0].value,max:u[1].value,marks:u}))))))))})),r.a.createElement(X.a,null,n)}(e.cityioData.GEOGRID.properties.types))})),de=a(746),pe=Object(q.a)({root:{width:"80%",marginLeft:28},subtitle1:{marginTop:12},subtitle2:{marginTop:12}});function me(e){var t=e.trips.tripsData,a=t.mode,n=t.profile;return r.a.createElement(r.a.Fragment,null,r.a.createElement(ie.a,{variant:"h6",gutterBottom:!0},"mode"===e.tripTypeValue?"Mode Choise":"Profiles "),r.a.createElement(oe.c,{height:300,width:150,items:function(e){var t="mode"===e?a:n,r=[];for(var o in t)r.push({title:t[o].name,color:t[o].color});return r}(e.tripTypeValue)}))}var fe=a(771),he=a(501),Ee=a(502),ge=a(412),ve=[{value:0,label:"12AM"},{value:21600,label:"6AM"},{value:43200,label:"12PM"},{value:64800,label:"6PM"},{value:86400,label:"12AM"}];var be=function(e){var t=pe(),a=Object(d.d)((function(e){return e.SLIDERS})),n=Object(d.c)(),o=r.a.useState("mode"),i=Object(x.a)(o,2),l=i[0],c=i[1];return r.a.createElement("div",{className:t.root},r.a.createElement(ge.a,{component:"fieldset"},r.a.createElement(he.a,{"aria-label":"tripType",name:"tripType",value:l,onChange:function(e){n({type:"LISTEN_TO_ABM_MODE",data:e.target.value}),c(e.target.value)}},r.a.createElement(Ee.a,{value:"mode",control:r.a.createElement(fe.a,null),label:"Mode Choice"}),r.a.createElement(Ee.a,{value:"profile",control:r.a.createElement(fe.a,null),label:"Profile"}))),r.a.createElement(me,{trips:e,tripTypeValue:l}),r.a.createElement(ie.a,{className:t.subtitle1,variant:"subtitle2",id:"range-slider",gutterBottom:!0},"Simulation Range"),r.a.createElement(H.a,{min:0,max:86400,marks:ve,value:a.time,onChange:function(e,t){n(g(Object(h.a)(Object(h.a)({},a),{},{time:t})))},valueLabelDisplay:"off","aria-labelledby":"range-slider"}),r.a.createElement(ie.a,{className:t.subtitle2,variant:"subtitle2",id:"continuous-slider",gutterBottom:!0},"Simulation Speed"),r.a.createElement(H.a,{min:0,max:100,value:a.speed,onChange:function(e,t){n(g(Object(h.a)(Object(h.a)({},a),{},{speed:t})))},valueLabelDisplay:"auto","aria-labelledby":"continuous-slider"}))},Oe=Object(q.a)({root:{width:"80%",marginLeft:28},subtitle1:{marginTop:12},subtitle2:{marginTop:12}});var ye=function(){var e=Oe(),t=Object(d.d)((function(e){return e.SLIDERS})),a=Object(d.c)();return r.a.createElement("div",{className:e.root},r.a.createElement(ie.a,{className:e.subtitle1,variant:"subtitle2",id:"range-slider",gutterBottom:!0},"Time of day"),r.a.createElement(H.a,{min:0,max:86400,marks:[{value:0,label:"12AM"},{value:21600,label:"6AM"},{value:43200,label:"12PM"},{value:64800,label:"6PM"},{value:86400,label:"12AM"}],value:t.time,onChange:function(e,n){a(g(Object(h.a)(Object(h.a)({},t),{},{time:n})))},valueLabelDisplay:"off","aria-labelledby":"range-slider"}))},Se=a(747);var je=function(e){var t=Object(d.d)((function(e){return e.ACCESS_TOGGLE})),a=e.cityioData,n=a&&a.access&&a.access.properties?a.access.properties:[],o=Object(d.c)(),i=I.map.layers.heatmap.colors,l=i.length-1;return r.a.createElement(X.a,null,r.a.createElement(Q.a,null,r.a.createElement(oe.b,{width:500,startColor:"rgb("+i[0][0]+","+i[0][1]+","+i[0][2]+")",endColor:"rgb("+i[l][0]+","+i[l][1]+","+i[l][2]+")",startTitle:"No Access",endTitle:"Full Access"})),n.map((function(e,a){return r.a.createElement(Q.a,{key:e},r.a.createElement(Z.a,{primary:e,style:{textTransform:"capitalize"}}),r.a.createElement(de.a,null,r.a.createElement(Se.a,{edge:"end",checked:t===a,onChange:function(){o({type:"LISTEN_TO_ACCESS_TOGGLE",data:a})}})))})))},De=a(338),Ce=a.n(De),Ie=a(748);var Te=function(e){for(var t=Object(q.a)((function(e){return{drawer:{display:"flex",paddingLeft:16,paddingRight:16,width:300,padding:e.spacing(0,1)},drawerPaper:{width:300}}}))(),a=e.open,n=e.toggleDrawer,o=e.handleToggle,i=Object(d.d)((function(e){return{menuState:e.MENU,cityioData:e.CITYIO}})),l=i.menuState,c=i.cityioData,s=I.menu.toggles,u=Object.keys(s),p=[],m=Object.keys(c),f=0;f<u.length;f++){var h=s[u[f]].requireModule,E=!!l.includes(u[f]);if(m.includes(h)||!1===h){var g=r.a.createElement("div",{key:u[f]},r.a.createElement(Q.a,null,r.a.createElement(Z.a,{primary:s[u[f]].displayName}),r.a.createElement(de.a,null,r.a.createElement(Se.a,{edge:"end",onChange:o(u[f]),checked:E}))),"SHADOWS"===u[f]&&r.a.createElement(K.a,{in:E,style:{width:"100%"}},r.a.createElement(ye,null)),"ABM"===u[f]&&r.a.createElement(K.a,{in:E,style:{width:"100%"}},r.a.createElement(be,{tripsData:c.ABM2.attr})),"ACCESS"===u[f]&&r.a.createElement(K.a,{in:E,style:{width:"80%",marginLeft:24}},r.a.createElement(je,{cityioData:c})));p.push(g)}}return r.a.createElement(J.a,{elevation:3,className:t.drawer,classes:{paper:t.drawerPaper},BackdropProps:{invisible:!0},anchor:"left",open:a,variant:"persistent"},r.a.createElement(X.a,{className:t.list},r.a.createElement(Q.a,{style:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(Ie.a,{color:"default",onClick:n},r.a.createElement(Ce.a,null))),r.a.createElement(Q.a,null,r.a.createElement(ie.a,{variant:"h5",gutterBottom:!0},"MIT CityScope")),r.a.createElement(Q.a,null,r.a.createElement(ie.a,{variant:"caption",gutterBottom:!0},"Toggle CityScope layers visability")),p))},we=a(544),Ae=a.n(we),Ne=a(339),Me=a.n(Ne),Re=a(219),_e=a.n(Re),ke=a(546),xe=a.n(ke),Le=a(545),Ge=a.n(Le),Pe=a(547),Be=a.n(Pe),Fe=a(503);function Ue(e){var t=Object(q.a)({root:{display:"flex",flexDirection:"column",position:"fixed",paddingLeft:16,paddingTop:8,zIndex:1}})(),a=Object(d.d)((function(e){return e.MENU})),n=e.handleToggle,o=e.toggleDrawer,i=e.toggleSaveDrawer;return r.a.createElement(X.a,{className:t.root},r.a.createElement(Q.a,null,r.a.createElement(Fe.a,{title:"Open Layer + Settings Menu"},r.a.createElement(Ie.a,{color:"default",onClick:o},r.a.createElement(Ae.a,null)))),r.a.createElement(Q.a,null,r.a.createElement(Fe.a,{title:"Toggle Edit Grid Mode, send to cityIO"},r.a.createElement(Ie.a,{color:"default",onClick:n("EDIT")},a.includes("EDIT")?r.a.createElement(_e.a,null):r.a.createElement(Me.a,null)))),r.a.createElement(Q.a,null,r.a.createElement(Fe.a,{title:"Reset View/Toggle Ortho"},r.a.createElement(Ie.a,{color:"default",onClick:n("RESET_VIEW")},a.includes("RESET_VIEW")?r.a.createElement(Ge.a,null):r.a.createElement(xe.a,null)))),r.a.createElement(Q.a,null,r.a.createElement(Fe.a,{title:"Save/Load Scenario"},r.a.createElement(Ie.a,{disabled:a.includes("EDIT"),color:"default",onClick:i},r.a.createElement(Be.a,null)))))}var We=Object(q.a)((function(e){return{root:{padding:e.spacing(0,1),display:"flex",paddingLeft:16,paddingRight:16},list:{paddingLeft:16,paddingRight:16,width:300,padding:e.spacing(0,1)}}})),ze=a(504),Ve=a(505),Ye=a(749),Je=a(753),qe=a(751),He=a(752),Xe=a(750);function Ke(e){var t=r.a.useState(!1),a=Object(x.a)(t,2),n=a[0],o=a[1],i=r.a.useState(""),l=Object(x.a)(i,2),c=l[0],s=l[1],u=Object(d.c)(),p=e.tableName,m=e.toggleDrawer,h=function(){o(!1)},E=Object(q.a)((function(e){return{button:{margin:e.spacing(1)}}}))(),g=Object(d.d)((function(e){return e.CITYIO})),v=Object(d.d)((function(e){return e.SCENARIO_NAMES})),b=function(e){var t={GEOGRIDDATA:g.GEOGRIDDATA,info:{id:e,name:c}},a={method:"post",url:I.cityIO.baseURL+"update/"+p+"/scenarios"+e,data:t,headers:{"Content-Type":"application/json",Accept:"application/json"}};F()(a).then((function(e){console.log("Successfully saved grid data and network"),u(O(!1)),m(),h()})).catch((function(e){console.log("%c"+e),console.log("ERROR:",e),h()}))};return r.a.createElement("div",{style:{marginLeft:12}},r.a.createElement(ze.a,{disabled:v.length>=10,variant:"outlined",color:"default",onClick:function(){o(!0)},className:E.button,startIcon:r.a.createElement(_e.a,null)},"Save Scenario"),r.a.createElement(Ye.a,{open:n,onClose:h,"aria-labelledby":"form-dialog-title"},r.a.createElement(Xe.a,{id:"form-dialog-title"},"Save Scenario"),r.a.createElement(qe.a,null,r.a.createElement(He.a,null,"Name:"),r.a.createElement(Ve.a,{autoFocus:!0,margin:"dense",id:"name",fullWidth:!0,value:c,onChange:function(e){return s(e.target.value)}})),r.a.createElement(Je.a,null,r.a.createElement(ze.a,{onClick:h,color:"default"},"Cancel"),r.a.createElement(ze.a,{onClick:function(){u(O(!0)),function(){var e={method:"get",url:I.cityIO.baseURL+p+"/meta/hashes",headers:{"Content-Type":"application/json",Accept:"application/json"}};F()(e).then((function(e){var t=Object.keys(e.data).filter((function(e){return e.includes("scenarios")})).map((function(e){return parseInt(e.replace("scenarios",""))}));console.log("successfully got scenarios");var a=t.length?Math.max.apply(Math,Object(f.a)(t))+1:0;b(a)})).catch((function(e){console.log("Error getting scenarios",e)}))}()},color:"default"},"Save"))))}var Qe=function(e){var t=e.toggleDrawer,a=Object(d.d)((function(e){return e.CITYIO})),n=Object(d.d)((function(e){return e.SCENARIO_NAMES})),o=Object(d.c)();return r.a.createElement("div",null,n.map((function(e){return r.a.createElement(Q.a,{key:e.id},r.a.createElement(ze.a,{style:{textTransform:"none"},onClick:function(){o(O(!0)),function(e,t){var n={method:"get",url:I.cityIO.baseURL+e+"/scenarios"+t,headers:{"Content-Type":"application/json",Accept:"application/json"}};F()(n).then((function(e){var t=e.data.GEOGRIDDATA;ne(t,a.tableName,"/GEOGRIDDATA")})).catch((function(e){console.log("ERROR:",e)}))}(a.tableName,e.id),t()}},r.a.createElement(ie.a,{variant:"h6"},e.name)),r.a.createElement(ze.a,{onClick:function(){o(O(!0)),function(e,t){var n={method:"get",url:I.cityIO.baseURL+"clear/"+e+"/scenarios"+t,headers:{"Content-Type":"application/json",Accept:"application/json"}};F()(n).then((function(e){W(a.tableName,(function(e){return o(y(e))}),(function(e){return o(O(e))}))})).catch((function(e){console.log("ERROR:",e)}))}(a.tableName,e.id)}},r.a.createElement(Ce.a,null)))})))};function Ze(e){var t=We(),a=e.tableName,n=e.open,o=e.toggleDrawer;return r.a.createElement(J.a,{className:t.root,BackdropProps:{invisible:!0},classes:{paper:t.paper},anchor:"left",open:n,onClose:o},r.a.createElement(X.a,{className:t.list},r.a.createElement(Q.a,null,r.a.createElement(ie.a,{variant:"h5",gutterBottom:!0},"Scenarios")),r.a.createElement(Q.a,null,r.a.createElement(ie.a,{variant:"caption",gutterBottom:!0},"Use this menu to save, load or delete design scenarios.")),r.a.createElement(Q.a,null,r.a.createElement(Ke,{tableName:a,toggleDrawer:o})),r.a.createElement(Qe,{toggleDrawer:o})))}var $e=function(e){var t=e.tableName,a=Object(d.d)((function(e){return e.MENU})),n=Object(d.c)(),o=r.a.useState({drawerOpen:!1,saveDrawerOpen:!1}),i=Object(x.a)(o,2),l=i[0],c=i[1],s=function(){c(Object(h.a)(Object(h.a)({},l),{},{drawerOpen:!l.drawerOpen}))},u=function(){c(Object(h.a)(Object(h.a)({},l),{},{saveDrawerOpen:!l.saveDrawerOpen}))},p=function(e){return function(){var t=a.indexOf(e),r=Object(f.a)(a);-1===t?r.push(e):r.splice(t,1),n({type:"MENU_INTERACTION",data:r})}},m=a&&a.includes("EDIT");return r.a.createElement("div",null,r.a.createElement(Te,{open:l.drawerOpen,toggleDrawer:s,handleToggle:p}),r.a.createElement(Ue,{toggleDrawer:s,handleToggle:p,toggleSaveDrawer:u}),m&&r.a.createElement(ue,{key:"EDIT"}),r.a.createElement(Ze,{tableName:t,handleToggle:p,toggleDrawer:u,open:l.saveDrawerOpen}))},et=a(549),tt=a.n(et),at=function(e){if(!e.mousePos||!e.hoveredCells)return null;var t=e.selectedType,a=e.hoveredCells.object.properties.interactive,n=e.mousePos,o=e.divSize,i=t.color;ae(i)&&(i=te(i));var l="rgb("+i[0]+","+i[1]+","+i[2]+")",c="rgba("+i[0]+","+i[1]+","+i[2]+",0.6)",s=n.clientX-o/2,u=n.clientY-o/2,d=a?t.name:"Not-interactive";return r.a.createElement("div",{style:{border:"2px solid",backgroundColor:e.mouseDown?c:"rgba(0,0,0,0)",borderColor:l,color:l,borderRadius:"15%",position:"fixed",zIndex:1,pointerEvents:"none",width:o,height:o,left:s,top:u}},r.a.createElement("div",{style:{position:"relative",left:o+10,fontSize:"0.8em"}},!a&&r.a.createElement(tt.a,null),d,":"))},nt=function(e){if(!e.mousePos)return null;var t=e.mousePos;return r.a.createElement("div",{style:{borderRadius:"15%",position:"fixed",pointerEvents:"none",backgroundColor:"rgba(0,0,0,0.5)",padding:"1vw",color:"rgba(255,255,255,0.9)",zIndex:1,left:t.clientX,top:t.clientY,fontSize:"0.65em",fontWeight:500}},r.a.createElement("p",null,"Type:",e.hoveredObj.object.properties.name),r.a.createElement("p",null,"Floors:",e.hoveredObj.object.properties.height),r.a.createElement("p",null,"ID:",e.hoveredObj.object.properties.id))};function rt(e){var t=e.editOn,a=e.mousePos,n=e.selectedType,o=e.pickingRadius,i=e.mouseDown,l=e.hoveredObj;return t?n&&r.a.createElement(at,{mousePos:a,selectedType:n,divSize:o,mouseDown:i,hoveredCells:l}):l&&r.a.createElement(nt,{mousePos:a,hoveredObj:l})}var ot=a(355),it=a(770),lt=(a(507),function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).animationFrame=null,n}return Object(c.a)(a,[{key:"componentWillUnmount",value:function(){this.animationFrame&&window.cancelAnimationFrame(this.animationFrame)}},{key:"componentDidMount",value:function(){this._animate()}},{key:"_animate",value:function(){var e=this.props,t=e.toggles,a=t.rotateOn,n=t.ABMOn,r=e.state,o=r.viewState,i=r.sliders,l=e.updaters,c=l.listenToSlidersEvents,s=l.sunEffects,u=l.setViewState,d=e.dispatch;if(a){var p=o.bearing?o.bearing:0;p<360?p+=.05:p=0,u(Object(h.a)(Object(h.a)({},o),{},{bearing:p}))}if(n){var m=i.time[1],f=i.speed,E=i.time[0],g=i.time[2],v=parseInt(m)+parseInt(f);(m<E||m>g)&&(v=E),d(c(Object(h.a)(Object(h.a)({},i),{},{time:[i.time[0],v,i.time[2]]}))),s&&s.updateSunDirection(v)}this.animationFrame=window.requestAnimationFrame(this._animate.bind(this))}},{key:"render",value:function(){return null}}]),a}(n.Component)),ct=a(724),st=a(539),ut=a(267),dt=function(e,t){var a=new Date;a.setHours(0,0,0,0);var n=new Date(a.getTime()+1e3*e);t.current[0].directionalLights[0].timestamp=Date.UTC(n.getFullYear(),n.getMonth(),n.getDay(),n.getHours(),n.getMinutes(),n.getSeconds())},pt=a(767);function mt(e){var t=e.data,a=e.accessToggle;return new pt.a({id:"ACCESS",colorRange:I.map.layers.heatmap.colors,radiusPixels:200,opacity:.5,threshold:.5,data:t,getPosition:function(e){return e.coordinates},getWeight:function(e){return e.values[a]},updateTriggers:{getWeight:[a]}})}var ft=a(369);function ht(e){var t=e.data,a=e.cityioData,n=e.ABMmode;return new ft.a({id:"AGGREGATED_TRIPS",_shadow:!1,data:t,getPath:function(e){var t=Math.random()<.5?5e-5*Math.random():-5e-5*Math.random();for(var a in e.path)e.path[a][0]=e.path[a][0]+t,e.path[a][1]=e.path[a][1]+t,e.path[a][2]=2*e.mode[0];return e.path},getColor:function(e){return te(a.ABM2.attr[n][e[n]].color)},opacity:.2,getWidth:1.5,updateTriggers:{getColor:n},transitions:{getColor:500}})}var Et=a(757);function gt(e){var t,a=e.data,n=e.cityioData,r=e.ABMmode,o=e.zoomLevel,i=e.sliders;return new Et.a({id:"ABM",data:a,getPath:function(e){return e.path},getTimestamps:function(e){return e.timestamps},getColor:function(e){return te(n.ABM2.attr[r][e[r]].color)},getWidth:1,widthScale:(t=o,t>15&&t<25?3:t<15&&t>10?12:30),opacity:.8,rounded:!0,trailLength:500,currentTime:i.time[1],updateTriggers:{getColor:r},transitions:{getColor:500}})}var vt=a(766);function bt(e){var t=e.data,a=e.editOn,n=e.state,r=n.selectedType,o=n.keyDownState,i=n.selectedCellsState,l=n.pickingRadius,c=e.updaters,s=c.setSelectedCellsState,u=c.setDraggingWhileEditing,d=c.setHoveredObj,p=e.deckGL;return new vt.a({id:"GRID",data:t,pickable:!0,extruded:!0,wireframe:!0,lineWidthScale:1,lineWidthMinPixels:2,getElevation:function(e){return e.properties.height},getFillColor:function(e){return e.properties.color},onClick:function(e){r&&a&&"Shift"!==o&&re(e,r,s,l,p)},onDrag:function(e){r&&a&&"Shift"!==o&&re(e,r,s,l,p)},onDragStart:function(){r&&a&&"Shift"!==o&&u(!0)},onHover:function(e){e.object&&d(e)},onDragEnd:function(){u(!1)},updateTriggers:{getFillColor:i,getElevation:i},transitions:{getFillColor:500,getElevation:500}})}function Ot(e){var t=Object(n.useState)(!1),a=Object(x.a)(t,2),o=a[0],i=a[1],l=Object(n.useState)(null),c=Object(x.a)(l,2),s=c[0],u=c[1],p=Object(n.useState)(I.map.initialViewState),m=Object(x.a)(p,2),f=m[0],E=m[1],v=Object(n.useState)(null),b=Object(x.a)(v,2),O=b[0],y=b[1],S=Object(n.useState)(null),j=Object(x.a)(S,2),D=j[0],C=j[1],T=Object(n.useState)(null),w=Object(x.a)(T,2),A=w[0],N=w[1],M=Object(n.useState)(null),R=Object(x.a)(M,2),_=R[0],k=R[1],L=Object(n.useState)(null),G=Object(x.a)(L,2),P=G[0],B=G[1],F=Object(n.useState)(null),W=Object(x.a)(F,2),z=W[0],V=W[1],Y=Object(n.useState)({}),J=Object(x.a)(Y,2),q=J[0],H=J[1],X=Object(n.useState)(!1),K=Object(x.a)(X,2),Q=K[0],Z=K[1],$=Object(n.useRef)(),ee=Object(n.useRef)(),te=Object(d.c)(),ae=Object(d.d)((function(e){return[e.CITYIO,e.SLIDERS,e.MENU,e.ACCESS_TOGGLE,e.SELECTED_TYPE,e.ABM_MODE]})),re=Object(x.a)(ae,6),oe=re[0],ie=re[1],le=re[2],ce=re[3],se=re[4],ue=re[5],de=le.includes("ABM"),pe=le.includes("ROTATE"),me=le.includes("SHADOWS"),fe=le.includes("EDIT"),he=le.includes("RESET_VIEW");Object(n.useEffect)((function(){ge(),function(e){var t=new ct.a({color:[255,255,255],intensity:.85}),a=new st.a({timestamp:15549272e5,color:[255,255,255],intensity:1,_shadow:!0}),n=new ut.a({ambientLight:t,dirLight:a});n.shadowColor=[0,0,0,.5],e.current=[n]}($),Ee(),Z(!0)}),[]),Object(n.useEffect)((function(){Q&&dt(ie.time[1],$)}),[ie.time]),Object(n.useEffect)((function(){if(Q){var e=me?[0,0,0,.5]:[0,0,0,0];$.current[0].shadowColor=e}}),[me]),Object(n.useEffect)((function(){V(function(e){var t=e.GEOGRID;if(e.GEOGRIDDATA&&e.GEOGRIDDATA.length===e.GEOGRID.features.length)for(var a=e.GEOGRIDDATA,n=0;n<t.features.length;n++)t.features[n].properties=a[n],t.features[n].properties.id=n;return JSON.parse(JSON.stringify(t))}(oe)),oe.access&&B(function(e){for(var t=e.access,a=t.features.map((function(e){return e.geometry.coordinates})),n=t.features.map((function(e){return e.properties})),r=[],o=0;o<a.length;o++)r.push({coordinates:a[o],values:n[o]});return r}(oe)),oe.ABM2&&H(oe.ABM2)}),[oe]),Object(n.useEffect)((function(){if(Q&&!fe){for(var e=[],t=0;t<z.features.length;t++)e[t]=z.features[t].properties;ne(e,oe.tableName,"/GEOGRIDDATA")}}),[fe]),Object(n.useEffect)((function(){Q&&(he?Ee():E(Object(h.a)(Object(h.a)({},f),{},{pitch:45})))}),[he]);var Ee=function(){var e=oe.GEOGRID.properties.header;E(Object(h.a)(Object(h.a)({},f),{},{longitude:e.longitude,latitude:e.latitude,zoom:15,pitch:0,bearing:360-e.rotation,orthographic:!0}))},ge=function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(e){return e.preventDefault()}))},ve={ABM:gt({data:q.trips,cityioData:oe,ABMmode:ue,zoomLevel:f.zoom,sliders:ie}),AGGREGATED_TRIPS:ht({data:q.trips,cityioData:oe,ABMmode:ue}),GRID:bt({data:z,editOn:le.includes("EDIT"),state:{selectedType:se,keyDownState:O,selectedCellsState:s,pickingRadius:40},updaters:{setSelectedCellsState:u,setDraggingWhileEditing:i,setHoveredObj:k},deckGL:ee}),ACCESS:mt({data:P,accessToggle:ce})},be=["ABM","AGGREGATED_TRIPS","GRID","ACCESS"];return r.a.createElement("div",{className:"baseMap",onKeyDown:function(e){y(e.nativeEvent.key)},onKeyUp:function(){return y(null)},onMouseMove:function(e){return C(e.nativeEvent)},onMouseUp:function(){return N(!1)},onMouseDown:function(){return N(!0)}},r.a.createElement(rt,{editOn:fe,mousePos:D,selectedType:se,pickingRadius:40,mouseDown:A,hoveredObj:_}),r.a.createElement(lt,{toggles:{ABMOn:de,rotateOn:pe},state:{sliders:ie,viewState:f},updaters:{listenToSlidersEvents:g,updateSunDirection:dt,setViewState:E},dispatch:te}),r.a.createElement(it.a,{ref:ee,viewState:f,onViewStateChange:function(e){var t=e.viewState;t.orthographic=!!le.includes("RESET_VIEW"),E(t)},layers:function(){var e,t=[],a=Object(U.a)(be);try{for(a.s();!(e=a.n()).done;){var n=e.value;le.includes(n)&&t.push(ve[n])}}catch(r){a.e(r)}finally{a.f()}return t}(),effects:$.current,controller:{touchZoom:!0,touchRotate:!0,dragPan:!o,dragRotate:!o,keyboard:!1}},r.a.createElement(ot.a,{asyncRender:!1,dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:I.map.mapStyle.blue,preventStyleDiffing:!0})))}var yt=a(650).solve,St=function(e,t){for(var a=[],n=[],r=0,o=e.length;r<o;++r){var i=Object(x.a)(e[r],2),l=i[0],c=i[1],s=Object(x.a)(t[r],2),u=s[0],d=s[1];a.push([l,c,1,0,0,0,-l*u,-c*u],[0,0,0,l,c,1,-l*d,-c*d]),n.push(u,d)}var p=yt(a,n,!0);return[p[0],p[3],0,p[6],p[1],p[4],0,p[7],0,0,1,0,p[2],p[5],0,1].map((function(e){return function(e,t){var a=Math.pow(10,t),n=e*a;return Math.round(n)/a}(e,10)}))},jt=function(e){return"matrix3d(".concat(e.join(", "),")")},Dt=function(e){return"translate(".concat(e[0],"px, ").concat(e[1],"px)")},Ct={container:{width:30,height:30,borderRadius:"50%",position:"absolute",border:"4px solid white",cursor:"move"},"top-left":{left:-15,top:-15},"bottom-left":{left:-15,bottom:-15},"top-right":{top:-15,right:-15},"bottom-right":{bottom:-15,right:-15}},It=function(e){var t=e.position,a=e.translation,r=e.onMouseEnter,o=e.onMouseDown,i=e.onMouseUp,l=e.className,c=void 0===l?"":l,s=e.style,u=void 0===s?{}:s;return n.createElement("div",{onMouseEnter:function(){return r&&r(t)},onMouseDown:function(e){return o(e,t)},onMouseUp:function(){return i(t)},className:c,style:Object(h.a)(Object(h.a)(Object(h.a)(Object(h.a)({},Ct.container),Ct[t]),u),{},{transform:Dt(a)})})},Tt=a(759),wt=a(556),At=a.n(wt),Nt=Object(q.a)((function(e){return{button:{margin:e.spacing(1),position:"fixed",top:"50vh",zIndex:1e3}}}));function Mt(){var e=Nt();return r.a.createElement(Tt.a,{container:!0,alignItems:"center",justify:"center"},r.a.createElement(ze.a,{variant:"contained",color:"secondary",className:e.button,startIcon:r.a.createElement(At.a,null)},"Reset Projection Mapping"))}var Rt={position:"relative"},_t=["top-left","top-right","bottom-right","bottom-left"],kt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],xt=function(){var e={};return _t.forEach((function(t){e[t]=[0,0]})),e},Lt=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).container=void 0,e.layerTranslateDelta=void 0,e.anchorTranslateDelta=void 0,e.isAnchorDragging=!1,e.targetPoints=void 0,e.anchorMoving=void 0,e.state={matrix:kt,translateDelta:xt(),sourcePoints:void 0,transformOrigin:[0,0],containerTranslate:[e.props.x||0,e.props.y||0]},e.onAnchorMouseDown=function(t,a){t.stopPropagation(),e.anchorTranslateDelta=[t.pageX-e.state.translateDelta[a][0],t.pageY-e.state.translateDelta[a][1]],e.anchorMoving=a},e.onAnchorMouseMove=function(t){if(e.anchorTranslateDelta&&e.state.sourcePoints&&e.anchorMoving){t.preventDefault(),t.stopPropagation();var a=_t.indexOf(e.anchorMoving),n=t.pageX-e.anchorTranslateDelta[0],r=t.pageY-e.anchorTranslateDelta[1];e.targetPoints[a]=[e.state.sourcePoints[a][0]+n,e.state.sourcePoints[a][1]+r],e.setState({matrix:St(e.state.sourcePoints,e.targetPoints),translateDelta:Object(h.a)(Object(h.a)({},e.state.translateDelta),{},Object(k.a)({},e.anchorMoving,[n,r]))})}},e.onAnchorMouseUp=function(t){e.anchorTranslateDelta=void 0,e.anchorMoving=void 0},e.onMouseUp=function(){e.layerTranslateDelta=void 0},e.onMouseMove=function(t){if(e.layerTranslateDelta&&e.props.isEditMode){var a=[t.pageX-e.layerTranslateDelta[0],t.pageY-e.layerTranslateDelta[1]];e.setState({containerTranslate:a})}},e.onMouseDown=function(t){var a=e.state.containerTranslate;e.layerTranslateDelta=[t.pageX-a[0],t.pageY-a[1]]},e._clearLocalStraoge=function(){localStorage.getItem("projMap")&&localStorage.removeItem("projMap"),window.location.reload()},e}return Object(c.a)(a,[{key:"componentDidMount",value:function(){if(window.addEventListener("mousemove",this.onAnchorMouseMove),window.addEventListener("mousemove",this.onMouseMove),this.container){var e=this.container.getBoundingClientRect(),t=e.width,a=e.height,n=[[0,0],[t,0],[t,a],[0,a]];this.targetPoints=[].concat(n),this.setState({sourcePoints:n})}}},{key:"componentDidUpdate",value:function(e,t){if(!e.isEditMode&&this.props.isEditMode){if(localStorage.getItem("projMap")){console.log("loading prev. projMap...");var a=localStorage.getItem("projMap");this.setState(JSON.parse(a))}}else e.isEditMode&&!this.props.isEditMode&&(console.log("saving edited projMap..."),localStorage.setItem("projMap",JSON.stringify(t)))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("mousemove",this.onAnchorMouseMove),window.removeEventListener("mousemove",this.onMouseMove)}},{key:"render",value:function(){var e=this,t=this.props,a=t.style,r=t.isEditMode,o=t.className,i=t.anchorStyle,l=t.anchorClassName,c=this.state,s=c.translateDelta,u=c.matrix,d=c.containerTranslate,p=c.transformOrigin;return n.createElement(n.Fragment,null,r&&n.createElement("div",{onClick:function(){return e._clearLocalStraoge()}},n.createElement(Mt,null)),n.createElement("div",{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,style:{cursor:r?"all-scroll":"inherit",position:"relative",display:"inline-block",transform:Dt(d)}},n.createElement("div",{ref:function(t){e.container=t},style:Object(h.a)(Object(h.a)(Object(h.a)({},Rt),a),{},{pointerEvents:r?"none":"all",transform:jt(u),transformOrigin:"".concat(p[0],"px ").concat(p[1],"px 0px")}),className:o},this.props.children),r&&n.createElement("div",null,_t.map((function(t,a){return n.createElement(It,{style:i,className:l,key:t,translation:s[t],position:t,onMouseDown:e.onAnchorMouseDown,onMouseUp:e.onAnchorMouseUp})})))))}}]),a}(n.Component),Gt=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r)))._checkKeystone=function(){return!!e.props.menu.includes("KEYSTONE")},e}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{style:{height:"100vh",width:"100vw",overflow:"hidden"}},r.a.createElement(Lt,{style:{height:"100vh",width:"100vw"},isEditMode:this._checkKeystone()},r.a.createElement(Ot,{menu:this.props.menu,selectedType:this.props.selectedType})))}}]),a}(n.Component),Pt=Object(d.b)((function(e){return{menu:e.MENU,selectedType:e.SELECTED_TYPE}}),null)(Gt),Bt=(a(511),a(651),function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={domains:[],radarData:[]},n.radarSize=n.props.drawerWidth-50,n.colorRange=["#fc03ec","#79C7E3"],n}return Object(c.a)(a,[{key:"generateData",value:function(){for(var e=this.props.cityioData.indicators,t={},a={},n=[],r=0;r<e.length;r++)"radar"===e[r].viz_type&&(t[e[r].name]=[e[r].value],a[e[r].name]=[e[r].ref_value],e[r].domain=[0,1],n.push(e[r]));this.setState({radarData:[t,a],domains:n})}},{key:"componentDidMount",value:function(){this.setState({indicators:this.props.indicators}),this.generateData()}},{key:"componentDidUpdate",value:function(e){e.cityioData.indicators!==this.props.cityioData.indicators&&(this.setState({indicators:this.props.indicators}),console.log("new radar data.."),this.generateData())}},{key:"render",value:function(){return this.props.cityioData.indicators?r.a.createElement("div",null,r.a.createElement(oe.f,{className:"Radar blur",animation:!0,data:this.state.radarData,domains:this.state.domains,colorRange:this.colorRange,style:{polygons:{fillOpacity:.2,strokeWidth:2},axes:{text:{opacity:0,fontWeight:700,fill:"white"},strokeWidth:0},labels:{textAnchor:"middle",fontSize:10,fill:"white"}},margin:{left:this.radarSize/6,top:this.radarSize/6,bottom:this.radarSize/6,right:this.radarSize/6},width:this.radarSize,height:this.radarSize},r.a.createElement(oe.a,{style:{fill:"white",fillOpacity:.1,backgroundColor:"#FFF",opacity:.5,stroke:"white",width:.1},tickValues:Object(f.a)(new Array(11)).map((function(e,t){return t/10-1}))})),r.a.createElement(oe.c,{items:["Design","Reference"],colors:this.colorRange})):null}}]),a}(n.Component)),Ft=a(557),Ut=a.n(Ft),Wt=Object(q.a)((function(e){return{root:{"& > *":{margin:e.spacing(1)}}}}));function zt(e){var t=Wt();return r.a.createElement("div",{className:t.root},r.a.createElement(ze.a,{onClick:function(){!function(e){var t=JSON.stringify(e),a=document.createElement("a"),n=new Blob([t],{type:"text/plain"});a.href=URL.createObjectURL(n),a.download="data.json",document.body.appendChild(a),a.click()}(e)},size:"small",variant:"outlined",color:"secondary",className:t.button,startIcon:r.a.createElement(Ut.a,null)},e.title))}var Vt=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={barChartData:null,hoverdNode:null},n.colorRange=["#fc03ec","#79C7E3"],n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.generateData()}},{key:"generateData",value:function(){for(var e=this.props.cityioData.indicators,t=[],a=0;a<e.length;a++)"bar"===e[a].viz_type&&t.push({x:e[a].name,y:e[a].value});this.setState({barChartData:t})}},{key:"componentDidUpdate",value:function(e){e.cityioData.indicators!==this.props.cityioData.indicators&&this.generateData()}},{key:"render",value:function(){var e=this,t=this.state.hoveredNode;return r.a.createElement(r.a.Fragment,null,this.state.barChartData&&r.a.createElement("div",null,t&&r.a.createElement(ie.a,{gutterBottom:!0},t.x," : ",t.y),r.a.createElement(oe.d,{opacity:.2,xType:"ordinal",width:this.props.drawerWidth-50,height:this.props.drawerWidth-50,stackBy:"y",yDomain:[0,1]},r.a.createElement(oe.i,{style:{text:{fill:"#FFF"}},tickLabelAngle:90}),r.a.createElement(oe.j,{style:{text:{fill:"#FFF"}}}),r.a.createElement(oe.h,{animation:!0,onValueMouseOver:function(t){e.setState({hoveredNode:t})},data:this.state.barChartData}),r.a.createElement(oe.h,{animation:!0,onValueMouseOver:function(t){e.setState({hoveredNode:t})},data:this.state.refChartData})),r.a.createElement(zt,{data:this.props.cityioData.indicators,title:"radar & bars data"})))}}]),a}(n.Component);function Yt(e){var t=e.drawerWidth-100,a=Object(n.useState)(!1),o=Object(x.a)(a,2),i=o[0],l=o[1],c=Object(q.a)((function(t){return{list:{width:e.drawerWidth-50}}}))(),s=function(){var t=e.cityioData.GEOGRID.properties.header.cellSize,a=e.cityioData.GEOGRIDDATA,n={};a.forEach((function(e){var a=e.name;if("None"!==e.name)if(n.hasOwnProperty(a)){n[a].count=n[a].count+1;var r=e.height<1?1:e.height;n[a].area=n[a].area+r*t}else n[a]={},n[a].area=0,n[a].count=0,n[a].name=a,n[a].color=function(e,t,a){function n(e){var t=e.toString(16);return 1===t.length?"0"+t:t}return"#"+n(e)+n(t)+n(a)}(e.color[0],e.color[1],e.color[2])}));var r=[];for(var o in n)r.push(n[o]);return{children:r,color:1}}();return r.a.createElement(X.a,{className:c.list},r.a.createElement(Q.a,null,i.name?r.a.createElement(ie.a,{gutterBottom:!0},i.name,": ",i.area," sqm"):r.a.createElement(ie.a,{gutterBottom:!0},"Hover on chart...")),r.a.createElement(Q.a,null,r.a.createElement(oe.g,{colorType:"literal",animation:!0,className:"donut-chart-example",innerRadius:t/2-t/5,radius:t/2,getLabel:function(e){return e.name},labelsRadiusMultiplier:.95,labelsStyle:{textAnchor:"middle",fontSize:11,fill:"#FFF",textShadow:"2px 2px 2px #000"},showLabels:!0,getAngle:function(e){return e.area},data:s.children,onValueMouseOver:function(e){return l(e)},onSeriesMouseOut:function(){return l(!1)},width:t,height:t,padAngle:.01},!1!==i&&r.a.createElement(oe.e,{value:i},r.a.createElement("div",{style:{background:"rgba(0,0,0,0.8)",fontSize:14}},r.a.createElement(ie.a,{variant:"caption",gutterBottom:!0},"Area: ",i.area," sqm"))))),r.a.createElement(Q.a,null,r.a.createElement(zt,{data:s.children,title:"area data"})))}var Jt=Object(d.b)((function(e){return{cityioData:e.CITYIO,menu:e.MENU}}),null)((function(e){var t=Object(q.a)((function(e){return{paper:{display:"flex","& > *":{margin:e.spacing(1)}},drawerPaper:{width:450}}}))(),a=e.menu&&e.menu.includes("RADAR");return r.a.createElement(r.a.Fragment,null,a&&r.a.createElement(J.a,{variant:"persistent",anchor:"right",open:!0,classes:{paper:t.drawerPaper}},r.a.createElement(X.a,{className:t.list},r.a.createElement(Q.a,null,r.a.createElement(ie.a,{variant:"h6",gutterBottom:!0},"Urban Indicators")),r.a.createElement("div",{className:t.paper},r.a.createElement(ce.a,{elevation:10},r.a.createElement(Q.a,null,r.a.createElement(Yt,{cityioData:e.cityioData,drawerWidth:450})))),r.a.createElement("div",{className:t.paper},r.a.createElement(ce.a,{elevation:10},r.a.createElement(Q.a,null,r.a.createElement(Bt,{cityioData:e.cityioData,drawerWidth:450})))),r.a.createElement("div",{className:t.paper},r.a.createElement(ce.a,{elevation:10},r.a.createElement(Q.a,null,r.a.createElement(Vt,{cityioData:e.cityioData,drawerWidth:450})))))))})),qt=a(558),Ht=a(418),Xt=a(560),Kt=a.n(Xt);function Qt(){var e=Object(qt.a)(["\n    display: block;\n    margin: 0 auto;\n    border-color: none;\n"]);return Qt=function(){return e},e}var Zt=Object(Ht.css)(Qt());var $t=function(){var e=Object(d.d)((function(e){return[e.LOADING_MODULES]})),t=Object(x.a)(e,1)[0];return r.a.createElement("div",{style:{position:"fixed",bottom:50,right:"50%",zIndex:1,display:"flex",flexDirection:"column",alignItems:"flex-end"}},t.map((function(e){return r.a.createElement("div",{key:e,style:{display:"flex",flexDirection:"row",marginBottom:"3px",marginTop:"3px"}},r.a.createElement(ie.a,{style:{marginRight:"10px"}},"loading ",e),r.a.createElement(Kt.a,{css:Zt,size:20,color:"white",loading:!0}))})))};function ea(e){var t=Object(d.d)((function(e){return e.READY})),a=e.tableName;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y,{tableName:a}),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement($e,{tableName:a}),r.a.createElement(Pt,null),r.a.createElement(Jt,null)),r.a.createElement($t,null))}var ta=a(761),aa=a(206),na=a(764),ra=a(562),oa=a.n(ra),ia=a(561),la=a.n(ia);function ca(){var e=Object(n.useState)({author:"",branch:"",date:"",sha:"",link:""}),t=Object(x.a)(e,2),a=t[0],o=t[1];return Object(n.useEffect)((function(){fetch("https://api.github.com/repos/CityScope/CS_cityscopeJS/branches/master").then((function(e){e.json().then((function(e){o({author:e.commit.commit.author.name,date:e.commit.commit.author.date,sha:e.commit.sha})}))})).catch((function(e){console.log(e)}))}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ie.a,{variant:"caption"},r.a.createElement("h2",null,"CityScopeJS Development Tracking"),r.a.createElement("h4",null,"Last Commit"),r.a.createElement("div",null,"Author: ",JSON.parse(JSON.stringify(a.author))),r.a.createElement("div",null,"Date: ",JSON.parse(JSON.stringify(a.date))),r.a.createElement("div",null,"Hash: ",JSON.parse(JSON.stringify(a.sha)))))}var sa=Object(q.a)((function(e){return{button:{margin:e.spacing(2)},root:{"& > *":{margin:e.spacing(1)},textAlign:"center",rounded:!0,paddingTop:100,margin:"auto",padding:2,maxWidth:600},flex:{display:"flex",alignItems:"baseline",justifyContent:"space-evenly"},inputRoot:{fontSize:60,width:300},labelRoot:{fontSize:20,color:"white","&$labelFocused":{color:"white",fontSize:10}},labelFocused:{color:"white"},caption:{margin:"auto",maxWidth:"30%"}}}));function ua(){var e=Object(n.useState)(null),t=Object(x.a)(e,2),a=t[0],o=t[1],i=sa();return r.a.createElement("div",{className:i.root},r.a.createElement(ie.a,{variant:"h3",gutterBottom:!0},"CityScopeJS"),r.a.createElement(se.a,{p:2}),r.a.createElement(ie.a,{variant:"h6",gutterBottom:!0},"CityScopeJS is a unified front-end for MIT CityScope project, an open-source urban modeling and simulation platform. CityScopeJS allows users to examine different urban-design alternatives, and observe their impact through multiple layers of urban analytics modules, such as economy, traffic and ABM simulation, urban access, storm-water, noise and more."),r.a.createElement(se.a,{p:5}),r.a.createElement("div",null,r.a.createElement(Ve.a,{autoComplete:"off",onChange:function(e){return function(e){var t=e.target.value;o(t)}(e)},InputProps:{classes:{root:i.inputRoot}},InputLabelProps:{classes:{root:i.labelRoot,focused:i.labelFocused}},id:"outlined-basic",label:"Type CityScope Project Name..."}),r.a.createElement("div",null,a&&r.a.createElement(ze.a,{onClick:function(){!function(){var e="https://cityscope.media.mit.edu/CS_cityscopeJS/?cityscope="+a;window.location.href=e}()},variant:"outlined",className:i.button},r.a.createElement(la.a,null),"Load CityScope Project"))),r.a.createElement(se.a,{p:5}),r.a.createElement("div",{className:i.flex},r.a.createElement(Ie.a,{color:"default",href:"https://cityscope.media.mit.edu/CS_cityscopeJS/?editor"},r.a.createElement(Me.a,null)),r.a.createElement("div",{className:i.caption},r.a.createElement(ie.a,{variant:"caption",gutterBottom:!0},"Click here to design and deploy a new CityScope project using Grid Editor")),r.a.createElement(se.a,{p:2}),r.a.createElement(Ie.a,{href:"http://github.com/CityScope/CS_cityscopeJS/",color:"default"},r.a.createElement(oa.a,null)),r.a.createElement("div",{className:i.caption},r.a.createElement(ie.a,{variant:"caption",gutterBottom:!0},"This open-source project is developed by the CityScope Network. Join us!"))),r.a.createElement(se.a,{p:5}),r.a.createElement(ca,null),r.a.createElement(se.a,{p:5}))}function da(e){if(!e.mousePos)return null;var t=e.mousePos,a=e.selectedType,n=e.divSize,o="rgba("+a.color[0]+","+a.color[1]+","+a.color[2]+",0.6)",i=t.clientX-n/2,l=t.clientY-n/2;return r.a.createElement("div",{style:{border:"2px solid",backgroundColor:e.mouseDown?o:"rgba(0,0,0,0)",borderColor:a.color,color:a.color,borderRadius:"15%",position:"fixed",zIndex:1,pointerEvents:"none",width:n,height:n,left:i,top:l}},r.a.createElement("div",{style:{position:"relative",left:n+10,fontSize:"0.5em"}},a.name))}var pa=a(62),ma=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null},fa=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e))._toggleOrthoView=function(e){e.orthographic=!!n.props.menu.includes("RESET_VIEW")},n._onViewStateChange=function(e){var t=e.viewState;n.setState({viewState:t})},n.componentDidUpdate=function(e){n.props.mapCenter!==e.mapCenter&&n.setState({viewState:Object(h.a)(Object(h.a)({},n.state.viewState),{},{latitude:n.props.mapCenter.latCenter,longitude:n.props.mapCenter.lonCenter,pitch:0,bearing:0,orthographic:!1})})},n._mulipleObjPicked=function(e){var t=n.state.pickingRadius,a=e.x-t/2,r=e.y-t/2;return n.deckGL.pickObjects({x:a,y:r,width:t,height:t})},n._handleGridcellEditing=function(e){if(n.props.selectedType){var t=n.props.selectedType,a=t.height,r=t.name,o=t.color,i=t.interactive,l=n._mulipleObjPicked(e);l.forEach((function(e){var t=e.object.properties;t.color=ma(o),t.height=parseInt(a),t.name=r,"No"!==i?t.interactive=i:delete t.interactive})),n.setState({selectedCellsState:l})}},n._renderSelectionTarget=function(){return n.props.selectedType&&r.a.createElement(da,{mousePos:n.state.mousePos,selectedType:n.props.selectedType,divSize:n.state.pickingRadius,mouseDown:n.state.mouseDown})},n._handleKeyUp=function(){n.setState({keyDownState:null})},n._handleKeyDown=function(e){n.setState({keyDownState:e.nativeEvent.key})},n.state={selectedType:null,draggingWhileEditing:!1,selectedCellsState:null,pickingRadius:40,viewState:pa.map.initialViewState},n.dirLightSettings={timestamp:Date.UTC(2019,7,1,12),color:[255,255,255],intensity:1,_shadow:!0},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this._rightClickViewRotate(),this._setViewStateToTableHeader()}},{key:"_setViewStateToTableHeader",value:function(){this.setState({viewState:Object(h.a)(Object(h.a)({},this.state.viewState),{},{latitude:pa.GEOGRID.properties.header.latitude,longitude:pa.GEOGRID.properties.header.longitude,zoom:15,pitch:0,bearing:0,orthographic:!0})})}},{key:"_rightClickViewRotate",value:function(){document.getElementById("deckgl-wrapper").addEventListener("contextmenu",(function(e){return e.preventDefault()}))}},{key:"_renderLayers",value:function(){var e=this,t=[];return t.push(new vt.a({id:"GRID",opacity:.5,stroked:!1,filled:!0,wireframe:!0,data:this.props.createdGrid,visible:!0,pickable:!0,extruded:!0,lineWidthScale:1,lineWidthMinPixels:1,getElevation:function(e){return e.properties.height},getFillColor:function(e){return e.properties.color},onClick:function(t,a){a.rightButton||"Shift"===e.state.keyDownState||e._handleGridcellEditing(t)},onDrag:function(t,a){a.rightButton||"Shift"===e.state.keyDownState||e._handleGridcellEditing(t)},onDragStart:function(t,a){a.rightButton||"Shift"===e.state.keyDownState||e.setState({draggingWhileEditing:!0})},onDragEnd:function(){e.setState({draggingWhileEditing:!1})},updateTriggers:{getFillColor:this.state.selectedCellsState,getElevation:this.state.selectedCellsState},transitions:{getFillColor:500,getElevation:500}})),t}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"baseMap",onKeyDown:this._handleKeyDown,onKeyUp:this._handleKeyUp,onMouseMove:function(t){return e.setState({mousePos:t.nativeEvent})},onMouseUp:function(){return e.setState({mouseDown:!1})},onMouseDown:function(){return e.setState({mouseDown:!0})}},this._renderSelectionTarget(),r.a.createElement(it.a,{ref:function(t){e.deckGL=t&&t.deck},viewState:this.state.viewState,onViewStateChange:this._onViewStateChange,layers:this._renderLayers(),controller:{touchZoom:!0,touchRotate:!0,dragPan:!this.state.draggingWhileEditing,dragRotate:!this.state.draggingWhileEditing,keyboard:!1}},r.a.createElement(ot.a,{dragRotate:!0,reuseMaps:!0,mapboxApiAccessToken:"pk.eyJ1IjoicmVsbm94IiwiYSI6ImNqd2VwOTNtYjExaHkzeXBzYm1xc3E3dzQifQ.X8r8nj4-baZXSsFgctQMsg",mapStyle:pa.map.mapStyle.sat,preventStyleDiffing:!0})))}}]),a}(n.Component),ha={listenToBaseMapCenter:C},Ea=Object(d.b)((function(e){return{selectedType:e.ROW_EDIT,mapCenter:e.BASE_MAP_CENTER,createdGrid:e.GRID_CREATED}}),ha)(fa),ga=a(417),va=a.n(ga);function ba(){var e=r.a.useState({columns:[{title:"Type",field:"name"},{title:"Height",field:"height",type:"numeric"},{title:"Interactive",field:"interactive",lookup:{No:"No",Web:"Web",TUI:"TUI"}},{title:"Color",field:"color",type:"string"},{title:"LBCS",field:"LBCS",type:"string"},{title:"NAICS",field:"NAICS",type:"string"}],data:function(e){var t=[];return Object.keys(e).forEach((function(a){t.push({name:a,color:e[a].color,height:e[a].height?e[a].height:0,LBCS:e[a].LBCS?JSON.stringify(e[a].LBCS):null,NAICS:e[a].NAICS?JSON.stringify(e[a].NAICS):null,interactive:e[a].interactive})})),t}(pa.GEOGRID.properties.types)}),t=Object(x.a)(e,2),a=t[0],o=t[1],i=Object(d.c)(),l=Object(n.useState)(null),c=Object(x.a)(l,2),s=c[0],u=c[1],p=Object(n.useState)(null),m=Object(x.a)(p,2),E=m[0],g=m[1];return Object(n.useEffect)((function(){i({type:"LISTEN_TO_TYPES_LIST",data:a.data})})),r.a.createElement("div",{style:{maxWidth:"100%"}},r.a.createElement(Tt.a,{container:!0},r.a.createElement(Tt.a,{item:!0,xs:12},r.a.createElement(va.a,{title:"Types Editor",columns:a.columns,data:a.data,options:{paging:!1,search:!1,selection:!1,rowStyle:function(e){return{backgroundColor:s===e.tableData.id?E:null}}},onRowClick:function(e,t){u(t.tableData.id),g(t.color),i(D(t))},editable:{onRowAdd:function(e){return new Promise((function(t){setTimeout((function(){t(),o((function(t){var a=Object(f.a)(t.data);return a.push(e),Object(h.a)(Object(h.a)({},t),{},{data:a})}))}),50)}))},onRowUpdate:function(e,t){return new Promise((function(a){console.log(e,t),setTimeout((function(){a(),t&&o((function(a){var n=Object(f.a)(a.data);return n[n.indexOf(t)]=e,Object(h.a)(Object(h.a)({},a),{},{data:n})})),i(D(e))}),50)}))},onRowDelete:function(e){return new Promise((function(t){setTimeout((function(){t(),o((function(t){var a=Object(f.a)(t.data);return a.splice(a.indexOf(e),1),Object(h.a)(Object(h.a)({},t),{},{data:a})}))}),50)}))}}}))))}var Oa=a(563),ya=a.n(Oa),Sa=a(281);function ja(e){return e*Math.PI/180}function Da(e){return 180*e/Math.PI}var Ca=function(e){var t=Object.keys(e);return e[t[t.length*Math.random()<<0]]};function Ia(e){var t=Object(d.c)(),a=function(){var a=function(e){for(var t=parseFloat(e.longitude),a=parseFloat(e.latitude),n=parseFloat(e.rotation),r=e.projection,o=parseFloat(e.cellSize),i=parseFloat(e.nrows),l=parseFloat(e.ncols),c=Sa.a.defs("EPSG:4326"),s={lon:t,lat:a},u=(90-n+360)%360,d=o*l/6371e3,p=ja(s.lat),m=ja(s.lon),f=ja(u),h=Math.asin(Math.sin(p)*Math.cos(d)+Math.cos(p)*Math.sin(d)*Math.cos(f)),E={lon:Da(m+Math.atan2(Math.sin(f)*Math.sin(d)*Math.cos(p),Math.cos(d)-Math.sin(p)*Math.sin(h))),lat:Da(h)},g=Object(Sa.a)(c,r,[s.lon,s.lat]),v=Object(Sa.a)(c,r,[E.lon,E.lat]),b=(v[1]-g[1])/(v[0]-g[0]),O=Math.atan(b),y=Math.cos(O),S=Math.sin(O),j=[],D=[],C=0;C<i;C++)for(var I=0;I<l;I++)j.push(I*o),D.push(-C*o);for(var T=[],w=[],A=0;A<j.length;A++)T.push(j[A]*y-D[A]*S),w.push(j[A]*S+D[A]*y);for(var N=[],M=[],R=0;R<T.length;R++)N.push(g[0]+T[R]),M.push(g[1]+w[R]);for(var _=N[1]-N[0],k=M[1]-M[0],x=N[l]-N[0],L=M[l]-M[0],G=[],P={type:"FeatureCollection",features:[]},B=pa.GEOGRID.properties.types,F=0;F<N.length;F++){for(var U=Ca(B),W={type:"Feature",geometry:{type:"Polygon",coordinates:null},properties:{color:ma(U.color),height:U.height,name:U.name,interactive:U.interactive,id:F}},z=[[N[F],M[F]],[N[F]+x,M[F]+L],[N[F]+x+_,M[F]+L+k],[N[F]+_,M[F]+k],[N[F],M[F]]],V=[],Y=0;Y<5;Y++){var J=Object(Sa.a)(r,c,z[Y]);V.push(J)}W.geometry.coordinates=[V],G.push(W)}return P.features=G,P}(e.gridProps);t({type:"LISTEN_TO_GRID_CREATOR",data:a})};return r.a.createElement(ze.a,{onClick:function(){a()},variant:"outlined",color:"default",startIcon:r.a.createElement(ya.a,null)},"Create Grid")}var Ta=a(564),wa=a.n(Ta),Aa=a(765),Na=function(e,t,a,n){var r=e,o={};return t.forEach((function(e){o[e.name]=e,o[e.name].LBCS="string"==typeof e.LBCS?JSON.parse(e.LBCS):e.LBCS,o[e.name].NAICS="string"==typeof e.NAICS?JSON.parse(e.NAICS):e.NAICS})),r.properties.types=o,r.properties.header=n,r.properties.header.longitude=parseFloat(r.properties.header.longitude),r.properties.header.latitude=parseFloat(r.properties.header.latitude),r.properties.header.rotation=parseFloat(r.properties.header.rotation),r.properties.header.nrows=parseFloat(r.properties.header.nrows),r.properties.header.ncols=parseFloat(r.properties.header.ncols),r.properties.header.cellSize=parseFloat(r.properties.header.cellSize),r.features=a,r};function Ma(e){var t=r.a.useState(null),a=Object(x.a)(t,2),n=a[0],o=a[1],i=Object(d.d)((function(e){return e})),l=i.GRID_CREATED,c=function(){var t=pa.GEOGRID,a=i.TYPES_LIST,n=i.GRID_CREATED.features,l=e.gridProps,c=Na(t,a,n,l),s=c.properties.header.tableName.toLowerCase(),u={geoGridURL:"https://cityio.media.mit.edu/api/table/update/"+s+"/GEOGRID",geoGridDataURL:"https://cityio.media.mit.edu/api/table/update/"+s+"/GEOGRIDDATA"},d=function(e,t){return{method:"post",url:e,data:t,headers:{"Content-Type":"application/json",Accept:"application/json"}}};F()(d(u.geoGridURL,c)).then((function(e){o(function(e,t){var a="https://cityscope.media.mit.edu/CS_cityscopeJS/?cityscope="+t;return r.a.createElement(ie.a,{variant:"caption"},"CityIO is ",e.data.status,". Grid deployed to"," ",r.a.createElement(Aa.a,{href:a},a))}(e,s))})).then((function(){F()(d(u.geoGridDataURL,{})),console.log("removed GEOGRIDDATA")})).then((function(){F()(d(u.geoGridDataURL,c)),console.log("mirrored GEOGRID to GEOGRIDDATA")})).catch((function(e){console.log("ERROR:",e)}))};return r.a.createElement(r.a.Fragment,null,l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(ze.a,{onClick:function(){c()},variant:"outlined",color:"default",startIcon:r.a.createElement(_e.a,null)},"Commit Grid to cityIO"),r.a.createElement(ze.a,{onClick:function(){!function(){var t=pa.GEOGRID,a=i.TYPES_LIST,n=i.GRID_CREATED.features,r=e.gridProps,o=Na(t,a,n,r),l="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(o)),c=document.createElement("a");c.setAttribute("href",l),c.setAttribute("download","grid.json"),document.body.appendChild(c),c.click(),c.remove()}()},variant:"outlined",color:"default",startIcon:r.a.createElement(wa.a,null)},"Download JSON"),r.a.createElement("div",{style:{width:"100%"}}," ",n)))}var Ra=a(565),_a=a.n(Ra);function ka(e){var t=Object(d.c)();return r.a.createElement(ze.a,{onClick:function(){t(C({latCenter:parseFloat(e.mapCenter[0]),lonCenter:parseFloat(e.mapCenter[1])}))},variant:"outlined",color:"default",startIcon:r.a.createElement(_a.a,null),style:{fontSize:"12px"}},"Center Map")}function xa(){var e=Object(q.a)((function(e){return{root:{"& .MuiTextField-root":{margin:e.spacing(1),flexWrap:"wrap"},"& > *":{margin:e.spacing(1)}},paper:{width:"100%"}}})),t=r.a.useState({tableName:"CityScopeJS",latitude:pa.GEOGRID.properties.header.latitude,longitude:pa.GEOGRID.properties.header.longitude,nrows:pa.GEOGRID.properties.header.nrows,ncols:pa.GEOGRID.properties.header.nrows,rotation:pa.GEOGRID.properties.header.rotation,cellSize:pa.GEOGRID.properties.header.cellSize,projection:pa.GEOGRID.properties.header.projection}),a=Object(x.a)(t,2),n=a[0],o=a[1],i=function(e){var t=e.target,a=t.id,r=t.value;o(Object(h.a)(Object(h.a)({},n),{},Object(k.a)({},a,r)))},l=e();return r.a.createElement(ce.a,{elevation:3,className:l.paper},r.a.createElement("form",{className:l.root,noValidate:!0,autoComplete:"off"},r.a.createElement(ie.a,{variant:"h6"},"Grid Properties"),r.a.createElement("div",{className:l.root},r.a.createElement(Ve.a,{onChange:function(e){return i(e)},variant:"outlined",className:l.textField,id:"tableName",label:"CityScope Project Name",defaultValue:n.tableName})),r.a.createElement("div",{className:l.root},r.a.createElement(Ve.a,{onChange:function(e){return i(e)},variant:"outlined",className:l.textField,id:"latitude",label:"Latitude",defaultValue:n.latitude,type:"number"}),r.a.createElement(Ve.a,{onChange:function(e){return i(e)},variant:"outlined",className:l.textField,id:"longitude",label:"Longitude",defaultValue:n.longitude,type:"number"})),r.a.createElement("div",{className:l.root},r.a.createElement(ka,{mapCenter:[n.latitude,n.longitude]})),r.a.createElement("div",{className:l.root},r.a.createElement(Ve.a,{onChange:function(e){return i(e)},variant:"outlined",className:l.textField,id:"nrows",label:"Rows",defaultValue:n.nrows,type:"number",InputProps:{inputProps:{max:100,min:0}}}),r.a.createElement(Ve.a,{onChange:function(e){return i(e)},variant:"outlined",className:l.textField,id:"ncols",label:"Columns",defaultValue:n.ncols,type:"number",InputProps:{inputProps:{max:100,min:0}}}),r.a.createElement(Ve.a,{onChange:function(e){return i(e)},variant:"outlined",className:l.textField,id:"rotation",label:"Rotation (deg)",defaultValue:n.rotation,type:"number",InputProps:{inputProps:{max:360,min:0}}}),r.a.createElement(Ve.a,{onChange:function(e){return i(e)},variant:"outlined",className:l.textField,id:"cellSize",label:"Cell Size (m^2)",defaultValue:n.cellSize,type:"number",InputProps:{inputProps:{max:1e3,min:0}}})),r.a.createElement("div",{className:l.root},r.a.createElement(Ve.a,{onChange:function(e){return i(e)},variant:"outlined",id:"projection",label:"Projection",defaultValue:n.projection,type:"string",helperText:"Note: wrong projection might break app. Find the relevant projection at: https://epsg.io/"})),r.a.createElement("div",{className:l.root},r.a.createElement(Ia,{gridProps:n}),r.a.createElement(Ma,{gridProps:n}))))}function La(){var e=Object(q.a)((function(e){return{drawer:{width:"50%"}}}))();return r.a.createElement(J.a,{className:e.drawer,variant:"persistent",anchor:"right",open:!0,classes:{paper:e.drawer}},r.a.createElement(X.a,null,r.a.createElement(Q.a,null,r.a.createElement(ie.a,{variant:"h5"},"CityScope Grid Editor")),r.a.createElement(Q.a,null,r.a.createElement(ie.a,{variant:"caption"},"Tool for creating CityScope endpoints with virtual editable girds, types, and props, and deploy them to cityIO.")),r.a.createElement(Q.a,null,r.a.createElement(xa,null)),r.a.createElement(Q.a,null,r.a.createElement(ba,null))))}var Ga=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ea,null),r.a.createElement(La,null))}}]),a}(n.Component),Pa=Object(aa.a)({palette:{type:"dark",background:{default:"#000",paper:"#1f252d"}}}),Ba=function(){var e=window.location.toString(),t="cityscope=",a=e.substring(e.indexOf(t)+t.length),n=null;return-1!==e.indexOf(t)&&a.length>0?(console.log("Loading CityScope project: "+a),n=r.a.createElement(ea,{tableName:a})):n="?editor"===window.location.search?r.a.createElement(Ga,null):r.a.createElement(ua,null),n},Fa=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement(ta.a,{theme:Pa},r.a.createElement(na.a,null),r.a.createElement(p,{store:_},r.a.createElement(Ba,null)))}}]),a}(n.Component),Ua=document.getElementById("root");i.a.render(r.a.createElement(Fa,null),Ua)}},[[603,1,2]]]);
//# sourceMappingURL=main.81671885.chunk.js.map